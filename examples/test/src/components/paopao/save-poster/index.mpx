<!-- 保存海报 -->
<template>
  <view>
    <view class="save-poster-component" bindtap="onClick"></view>
  </view>
</template>

<script>
  import { createComponent } from '@mpxjs/core'
  import { saveImage } from '../../../common/js/bridge'
  import { trackEvent } from '../../../common/js/Omega'

  createComponent({
    properties: {
      posterUrl: {
        type: String,
        value: ''
      }
    },
    data: {
      isSaving: false
    },
    methods: {
      onClick () {
        trackEvent('wyc_mkt_ppyuyue_leader_invite_haibao_pop_ck')
        if (this.isSaving) return
        this.isSaving = true
        // 保存海报
        saveImage(this.posterUrl, (res) => {
          this.isSaving = false
          const errno = Number(res.errno)
          const texts = [
            '保存成功',
            '参数错误',
            '存储权限获取失败',
            '图片格式错误',
            '保存图片失败'
          ]
          this.showToast(texts[errno])
          if (errno === 0) {
            this.triggerEvent('success')
          }
        })
      }
    }
  })
</script>

<style lang="stylus">
@import "../../../common/stylus/mixin.styl"

  .save-poster-component
    background-image url('https://dpubstatic.udache.com/static/dpubimg/b0f0f80e-1779-4e6b-9591-809d8e38e080.png')
    background-size cover
    position fixed
    z-index 90
    width 70px
    height 70px
    top vw(816)
    right 0
    // transform translateY(-50%)
</style>

<script type="application/json">
  {
    "component": true
  }
</script>
