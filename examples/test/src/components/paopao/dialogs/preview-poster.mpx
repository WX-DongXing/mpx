<template>
  <view class="preview-poster-component" wx:show="{{appear}}" @touchmove.prevent@web>
    <view class="preview-poster-content">
      <text class="preview-poster-close-btn" bindtap@wx="toggle" @click.stop@web="toggle"></text>
      <img wx:if="{{ __mpx_mode__ === 'web' }}" class="preview-poster" src="{{url}}" />
      <view class="preview-poster-tips">
        <rich-text class="preview-poster-tip" nodes="{{item}}" wx:for="{{formattedHTMLStringList}}" wx:key="index" />
      </view>
      <view class="preview-poster-btn" bindtap@wx="toggle" @click.stop@web="toggle">我知道了</view>
    </view>
  </view>
</template>

<script>
  import { createComponent } from '@mpxjs/core'

  createComponent({
    properties: {
      url: {
        type: String,
        value: ''
      }
    },
    data: {
      texts: ['已保存海报至{系统相册}', '快{喊好友}一起预约'],
      appear: false
    },
    methods: {
      toggle () {
        this.appear = !this.appear
      },
      strToHTML (str = '') {
        return str.replace(/\{(.+?)\}/g, (match, $1) => {
          return `<span style="color: #FF7F41;">${$1}</span>`
        })
      }
    },
    computed: {
      formattedHTMLStringList () {
        return this.texts.map(text => this.strToHTML(text))
      }
    }
  })
</script>

<style lang="stylus">
  @import "../../../common/stylus/mixin.styl"
  .preview-poster-component
    z-index 100
    position fixed
    left 0
    right 0
    top 0
    bottom 0
    background-color rgba(0, 0, 0, 0.7)
    .preview-poster-content
      position absolute
      bottom 0
      left 0
      width 100%
      height vw(332)
      background-color white
      border 1px solid #979797
      border-radius 35px 35px 0 0
      text-align center
    .preview-poster
      width 252px
      height auto
      position absolute
      top 24px
      left 50%
      transform translateY(-100%) translateX(-50%)
    .preview-poster-tips
      margin-top vw(82)
      text-align center
      margin-bottom vw(28)
    .preview-poster-tip
      color #393939
      font-size vw(36)
      font-weight bold
      height vw(50)
      line-height vw(50)
    .preview-poster-btn
      margin-top 14px
      display inline-block
      width 185px
      height 40px
      line-height 40px
      text-align center
      color white
      font-size 16px
      font-weight bold
      border-radius 26px
      background-color #FF7F41
      margin 0 auto
    .preview-poster-close-btn
      position absolute
      right 20px
      top 15px
      width 24px
      height 24px
      background-image url('../../../assets/btn-close.png')
      background-size cover
      expand-touch()
</style>

<script type="application/json">
  {
    "component": true
  }
</script>
