<!-- 活动授权须知弹窗 -->
<template>
  <base-dialog title="《活动授权须知》" wx:ref="dialog" refKey="{{refKey}}" bind:emitBaseEvent="emitEvent">
    <view
      wx:if="{{__mpx_mode__ === 'web'}}"
      class="authorization-agreement-content"
      catchtouchmove="touchmoveFun"
      @touchmove@web="touchmoveFun"
    >
      <view wx:for="{{texts}}" wx:key="index">{{item}}</view>
    </view>
    <scroll-view wx:else scroll-y="{{true}}" class="authorization-agreement-content">
      <view wx:for="{{texts}}" wx:key="index">{{item}}</view>
    </scroll-view>
    <view class="authorization-agreement-btn-group">
      <text class="authorization-agreement-refuse-btn" bindtap@wx="onRefuse" @click.stop@web="onRefuse">再想想</text>
      <text class="authorization-agreement-agree-btn" bindtap@wx="onAgree" @click.stop@web="onAgree">同意并预约</text>
    </view>
  </base-dialog>
</template>

<script>
  import { createComponent } from '@mpxjs/core'
  import emitEvents from '../../../common/mixins/emitEvents'
  import { trackEvent } from '../../../common/js/Omega'
  
  createComponent({
    properties: {
      text: {
        type: String,
        value: ''
      }
    },
    mixins: [emitEvents],
    data: {
      refKey: 'agreementDialog'
    },
    computed: {
      texts () {
        return this.text.split('\n')
      }
    },
    methods: {
      onRefuse () {
        this.toggle()
        trackEvent('wyc_mkt_ppyuyue_authorization_detail_ck', {
          btn_title: '再想想'
        })
      },
      onAgree () {
        this.toggle()
        this.triggerEvent('agree')
      },
      toggle () {
        const dialog = this.$refs.dialog
        dialog && dialog.toggle()
      },
      touchmoveFun (e) {
        return e
      }
    }
  })
</script>

<style lang="stylus">
  @import "../../../common/stylus/mixin.styl"
  .authorization-agreement-content
    margin vw(33) vw(20) 0
    padding vw(30) vw(40) 0
    height 100%
    border-bottom-width vw(190)
    border-style solid
    border-color transparent
    box-sizing border-box
    background-color #FFFAEF
    border-radius 20px 20px 0 0
    font-size 14px
    color #703419
    line-height 22px
    overflow auto
  .authorization-agreement-btn-group
    position absolute
    left 0
    right 0
    bottom 16px
    font-size 0
  .authorization-agreement-refuse-btn
    color #C47971
    text-align center
    line-height vw(104)
    font-size 20px
    display inline-block
    width vw(200)
    height vw(104)
    margin-left vw(38)
    background-image url('https://dpubstatic.udache.com/static/dpubimg/f57087df-ed44-4961-9107-20d562164720.png')
    background-size cover
  .authorization-agreement-agree-btn
    color #943025
    font-size 20px
    text-align center
    display inline-block
    line-height vw(104)
    font-weight bold
    height vw(104)
    width vw(460)
    margin-left vw(12)
    background-image url('https://dpubstatic.udache.com/static/dpubimg/5ee68e2e-82e3-4e3c-ab52-c89a20fca2ab.png')
    background-size cover
    background-repeat no-repeat
</style>

<script type="application/json">
  {
    "component": true,
    "usingComponents": {
      "base-dialog": "./base"
    }
  }
</script>
