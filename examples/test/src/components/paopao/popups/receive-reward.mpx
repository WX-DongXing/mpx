<!-- 活动结束后，收到奖励的弹窗 -->
<template>
  <base-popup
    wx:ref="receiveReward"
    title="{{content.dialog_title}}"
    refKey="{{refKey}}"
    bind:emitBaseEvent="emitEvent"
  >
    <view class="receive-reward-popup-subtitle">- 跑跑预约礼 -</view>
    <view class="receive-reward-popup-content">
      <number-animation
        class="receive-reward-popup-content-number"
        value="{{formattedHTMLString.numTxt}}"
        options="{{options}}"
      >
      </number-animation>
      <view class="receive-reward-popup-content-Txt">{{formattedHTMLString.afterTxt}}</view>
    </view>
    <view class="receive-reward-popup-tips-wrapper">
      <view wx:if="{{content.desc}}" class="receive-reward-popup-tip">{{content.desc}}</view>
      <view
        wx:if="{{content.sub_desc}}"
        class="receive-reward-popup-tip"
      >{{content.sub_desc}}</view>
    </view>
    <view
      bindtap@wx="onClick"
      @click.stop@web="onClick"
      class="receive-reward-popup-button"
    >{{content.button_desc}}</view>
  </base-popup>
</template>

<script>
  import { createComponent } from '@mpxjs/core'
  import emitEvents from '../../../common/mixins/emitEvents'
  import { trackEvent } from '../../../common/js/Omega'
  
  createComponent({
    properties: {
      popupInfo: {
        type: Object,
        value: {}
      }
    },
    data: {
      refKey: 'receiveRewardPopup',
      options: {
        height: 70, // (number) 滚动行高 px
        className: 'reward-small'
      }
    },
    mixins: [emitEvents],
    computed: {
      content () {
        return this.popupInfo.context || {}
      },
      formattedHTMLString () {
        const separator = '  '
        const str = (this.content.tip || '').replace(/\{|\}/g, separator)
        const strMap = str.split(separator)
        return {
          preTxt: strMap[0],
          numTxt: strMap[1],
          afterTxt: strMap[2]
        }
      }
    },
    methods: {
      toggle () {
        const dialog = this.$refs.receiveReward
        dialog && dialog.toggle()
      },
      onClick () {
        this.toggle()
        trackEvent('wyc_mkt_ppyuyue_leader_share_pop_btn_ck',
          {
            btn_type: 3,
            btn_title: this.content.button_desc
          }
        )
      }
    }
  })
</script>

<style lang="stylus">
  @import "../../../common/stylus/mixin.styl"
  .receive-reward-popup-subtitle
    font-size 12px
    line-height 16px
    position absolute
    top vw(352)
    color #E6B283
    text-align center
    width 100%
  .receive-reward-popup-content
    display flex
    justify-content center
    align-items flex-end
    position absolute // 不用 padding-top 的原因是小程序样式表现不一致
    top vw(405)
    width 100%
    text-align center
    font-size vw(45)
    font-weight bold
    line-height 34px
    color #F45B3E
    text-align center
  .receive-reward-popup-content-Txt
    font-size vw(45)
  .receive-reward-popup-content-number
    font-family dinum
    color #EE5538
    font-size vw(150)
    line-height vw(241)
    font-weight normal
    // margin 0 vw(6)
  .receive-reward-popup-tips-wrapper
    position absolute
    bottom vw(184)
    width 100%
    text-align center
  .receive-reward-popup-tip
    font-size vw(34)
    font-weight bold
    color #FFEDDB
    line-height vw(48)
  .receive-reward-popup-button
    width vw(506)
    height vw(104)
    line-height vw(104)
    font-size 20px
    font-weight bold
    color #943025
    text-align center
    position absolute
    left vw(122)
    bottom vw(62)
    background-image url('https://dpubstatic.udache.com/static/dpubimg/34b80f06-d556-48b5-91aa-0ca20e3d03ef.png')
    background-size cover
    background-color transparent
    background-repeat no-repeat
    &:after
      border none
</style>

<script type="application/json">
  {
    "component": true,
    "usingComponents": {
      "base-popup": "./base",
      "number-animation": "../../number-animation/index"
    }
  }
</script>
