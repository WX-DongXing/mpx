<!-- 客态打开主态的页面，提示接受好友邀请 -->
<template>
  <base-popup
    wx:ref="receiveInvite"
    title="{{content.dialog_title}}"
    refKey="{{refKey}}"
    bind:emitBaseEvent="emitEvent"
    bind:closed="onClosed"
    >
    <view class="receive-friend-invite-popup-content">
      <text class="receive-friend-invite-popup-content-txt">{{formattedHTMLString.preTxt}}</text>
      <number-animation
        class="receive-friend-invite-popup-content-number" 
        wx:class="{{numberClass}}"
        value="{{formattedHTMLString.numTxt}}"
      >
      </number-animation>
      <view class="receive-friend-invite-popup-content-txt">
        {{formattedHTMLString.afterTxt}}
        <view class="receive-friend-invite-popup-content-badge" wx:class="{{numberClass}}">
          <view>最</view>
          <view>高</view>
        </view>
      </view>
    </view>
    <view class="receive-friend-invite-popup-tips-wrapper">
      <view wx:if="{{content.desc}}" class="receive-friend-invite-popup-tip">{{content.desc}}</view>
      <view wx:if="{{content.sub_desc}}" class="receive-friend-invite-popup-tip">{{content.sub_desc}}</view>
    </view>
    <view
      bindtap@wx="onClick()"
      @click.stop@web="onClick()"
      class="receive-friend-invite-popup-button"
    >{{content.button_desc}}</view>
    <view
      class="receive-friend-invite-popup-authorization"
    >
      <authorization-text
        type="{{'popup'}}"
        bind:updated="onUpdated"
      /></view>
  </base-popup>
</template>

<script>
  import { createComponent } from '@mpxjs/core'
  import emitEvents from '../../../common/mixins/emitEvents'
  import { trackEvent } from '../../../common/js/Omega'
  
  createComponent({
    properties: {
      popupInfo: {
        type: Object,
        value: {}
      }
    },
    data: {
      refKey: 'receiveInvitationPopup'
    },
    mixins: [emitEvents],
    computed: {
      content () {
        return this.popupInfo.context || {}
      },
      formattedHTMLString () {
        const separator = '  '
        const str = (this.content.tip || '').replace(/\{|\}/g, separator)
        const strMap = str.split(separator)
        return {
          preTxt: strMap[0],
          numTxt: strMap[1],
          afterTxt: strMap[2]
        }
      },
      numberClass () {
        const len = (this.formattedHTMLString.numTxt + '').length
        return len > 1 ? 'multiple-number' : 'single-number'
      }
    },
    methods: {
      toggle () {
        const dialog = this.$refs.receiveInvite
        dialog && dialog.toggle()
      },
      onClick () {
        this.toggle()
        this.triggerEvent('signUp')
        trackEvent('wyc_mkt_ppyuyue_follower_main_pop_follow_ck')
      },
      onUpdated () {
        this.toggle()
        this.triggerEvent('updated')
      },
      onClosed () {
        // 拒绝好友的邀请
        this.triggerEvent('refused')
      }
    }
  })
</script>

<style lang="stylus">
  @import "../../../common/stylus/mixin.styl"
  .receive-friend-invite-popup-content-wrapper
    position relative
  .receive-friend-invite-popup-content
    display flex
    justify-content center
    align-items flex-end
    position absolute // 不用 padding-top 的原因是小程序样式表现不一致
    top vw(371)
    width 100%
    text-align center
    font-size vw(46)
    line-height vw(50)
    color #F45B3E
  .receive-friend-invite-popup-content-badge
    position absolute
    top -55px
    right 0
    font-size 12px
    line-height 13px
    color #C6A368
    letter-spacing 1px
    padding 3px
    background-color #FFEEC9
    border-radius 4px
    font-weight normal
    // &.single-number
    //   right vw(225)
  .receive-friend-invite-popup-content-txt
    position relative
    font-size vw(45)
    font-weight bold
  .receive-friend-invite-popup-content-number
    font-family dinum
    color #EE5538
    font-size 103px
    line-height 120px
    font-weight normal
    &.single-number
      margin 0 vw(10)
  .receive-friend-invite-popup-tips-wrapper
    position absolute
    bottom vw(215)
    width 100%
    text-align center
  .receive-friend-invite-popup-tip
    font-size vw(34)
    font-weight bold
    color #FFEDDB
    line-height vw(48)
  .receive-friend-invite-popup-button
    width vw(506)
    height vw(104)
    line-height vw(104)
    font-size 20px
    font-weight bold
    color #943025
    text-align center
    position absolute
    left vw(122)
    bottom vw(97)
    // background-image url('https://dpubstatic.udache.com/static/dpubimg/28090c2e-7c28-418a-a5cc-0079d9f0c7f1.png')
    background-image url('https://dpubstatic.udache.com/static/dpubimg/34b80f06-d556-48b5-91aa-0ca20e3d03ef.png')
    background-size cover
    background-color transparent
    background-repeat no-repeat
  .receive-friend-invite-popup-authorization
    position absolute
    bottom vw(33.5)
    width 100%
    height vw(62)
    display flex
    align-items center
    justify-content center
</style>

<script type="application/json">
  {
    "component": true,
    "usingComponents": {
      "base-popup": "./base",
      "authorization-text": "../authorization-text/index",
      "number-animation": "../../number-animation/index"
    }
  }
</script>
