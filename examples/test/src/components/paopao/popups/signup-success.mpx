<!-- 点击立即预约成功之后的弹窗 -->
<template>
  <base-popup
    title="{{content.dialog_title}}"
    wx:ref="signupSuccessBase"
    refKey="{{refKey}}"
    bind:emitBaseEvent="emitEvent"
  >
    <view class="signup-success-popup-content">
      <text class="signup-success-popup-content-txt">{{formattedHTMLString.preTxt}}</text>
      <number-animation
        wx:if="{{showNumberAnimation}}"
        wx:ref="signupSuccessBaseNumber"
        class="signup-success-popup-content-number" 
        wx:class="{{numberClass}}"
        value="{{formattedHTMLString.numTxt}}"
      >
      </number-animation>
      <text class="signup-success-popup-content-txt">{{formattedHTMLString.afterTxt}}</text>
    </view>
    <view class="signup-success-popup-tips-wrapper">
      <view
        wx:if="{{content.desc}}"
        class="signup-success-popup-tip"
      >{{content.desc}}</view>
      <view
        wx:if="{{content.sub_desc}}"
        class="signup-success-popup-tip"
      >{{content.sub_desc}}</view>
    </view>
    <view
      wx:if="{{ __mpx_mode__ === 'web' }}"
      @click.stop="invite"
      class="signup-success-popup-button"
    >{{content.button_desc}}</view>
    <button
      wx:else
      open-type="share"
      class="signup-success-popup-button"
      id="signupSuccessBtn"
    >{{content.button_desc}}</button>
  </base-popup>
</template>

<script>
  import emitEvents from '../../../common/mixins/emitEvents'
  import { createComponent } from '@mpxjs/core'
  import { trackEvent } from '../../../common/js/Omega'
  const EVENT_INVITE_SIGN_UP = 'inviteSignUp'

  createComponent({
    properties: {
      popupInfo: {
        type: Object,
        value: {}
      },
      status: {
        type: String
      }
    },
    data: {
      refKey: 'signupSuccessDialog',
      showNumberAnimation: false
    },
    mixins: [emitEvents],
    computed: {
      content () {
        return this.popupInfo.context || {}
      },
      formattedHTMLString () {
        const separator = '  '
        const str = (this.content.tip || '').replace(/\{|\}/g, separator)
        const strMap = str.split(separator)
        return {
          preTxt: strMap[0],
          numTxt: strMap[1],
          afterTxt: strMap[2]
        }
      },
      numberClass () {
        const len = (this.formattedHTMLString.numTxt + '').length
        return len > 1 ? 'multiple-number' : 'single-number'
      }
    },
    methods: {
      toggle () {
        const dialog = this.$refs.signupSuccessBase
        dialog && dialog.toggle()
        this.showNumberAnimation = true
      },
      invite () {
        this.toggle()
        this.triggerEvent(EVENT_INVITE_SIGN_UP)
        trackEvent('wyc_mkt_ppyuyue_leader_share_pop_btn_ck', {
          btn_type: 1,
          btn_title: this.content.sub_desc
        })
      }
    }
  })
</script>

<style lang="stylus">
  @import "../../../common/stylus/mixin.styl"
  .signup-success-popup-content
    display flex
    justify-content center
    align-items flex-end
    position absolute // 不用 padding-top 的原因是小程序样式表现不一致
    top vw(371)
    width 100%
    font-size vw(46)
    line-height vw(50)
    color #F45B3E
    text-align center
  .signup-success-popup-content-txt
    font-size vw(45)
    font-weight bold
  .signup-success-popup-content-number
    font-family dinum
    color #EE5538
    font-size 103px
    line-height 120px
    font-weight normal
    &.single-number
      margin 0 vw(10)
  .signup-success-popup-tips-wrapper
    position absolute
    bottom vw(198)
    width 100%
    text-align center
  .signup-success-popup-tip
    font-size vw(34)
    font-weight bold
    color #FFEDDB
    line-height vw(48)
  .signup-success-popup-button
    width vw(506)
    height vw(104)
    line-height vw(104)
    font-size 20px
    font-weight bold
    color #943025
    text-align center
    position absolute
    left vw(122)
    bottom vw(62)
    background-image url('https://dpubstatic.udache.com/static/dpubimg/34b80f06-d556-48b5-91aa-0ca20e3d03ef.png')
    background-size cover
    background-color transparent
    background-repeat no-repeat
    &:after
      border none
</style>

<script type="application/json">
  {
    "component": true,
    "usingComponents": {
      "base-popup": "./base",
      "number-animation": "../../number-animation/index"
    }
  }
</script>
