<template>
  <view class="accelerate-reward intersectionRootNode" v-exposure@web="exposure">
    <card-base
      title="{{info.title}}"
      remainingTime="{{info.count_down_sec}}"
      bind:finish="countDownFinish"
    >
      <horizontal-reward-container
        list="{{list}}"
        sizeType="size-big"
        bind:clickItem="goRewardDetail"
      />
      <view class="accelerate-reward-city-tag">
        <view class="city-name">{{cityName}}</view>
      </view>
    </card-base>
  </view>
</template>

<script>
import { createComponent } from '@mpxjs/core'
import { universelPageJump } from '../../../common/js/pageJump'
import { trackAggregateEvent } from '../../../common/js/Omega'
import intersectionObserverMixin from '../../../common/mixins/intersectionObserver'

createComponent({
  mixins: [intersectionObserverMixin],
  options: {
    addGlobalClass: true,
    styleIsolation: 'shared'
  },
  properties: {
    info: {
      type: Object,
      value: {}
    }
  },
  data: {
    intersectionOtherEventId: 'wyc_main_venue_jrjl_jsk_sw' // 小程序模块出现在视口的埋点
  },
  computed: {
    list () {
      const info = this.info || {}
      return info.list || []
    },
    cityName () {
      const city = this.info && this.info.city
      if (city) {
        if (city.length <= 3) {
          return city
        } else if (city.length > 3) {
          return '本市'
        }
      }
      return '本市'
    }
  },
  methods: {
    exposure () {
      this.exposureH5()
    },
    exposureH5 () {
      this.list.map(item => {
        const params = {}
        params.act_id = item.activity_id
        trackAggregateEvent(this.intersectionOtherEventId, params)
      })
    },
    goRewardDetail (subItem) {
      trackAggregateEvent('wyc_main_venue_jrjl_jsk_ck', {
        act_id: subItem.detail.activity_id
      })
      const url = subItem.detail.jump_url || ''
      const ret = universelPageJump(url)
      // 走客服会话逻辑
      if (ret === true) {
        this.triggerEvent('customerService')
      }
    },
    countDownFinish () {
      this.triggerEvent('refresh')
    }
  }
})
</script>

<style lang="stylus">
@import "../../../common/stylus/mixin.styl"
.accelerate-reward
  margin-top vw(37)
  position relative
  width 100%
  height vw(348)
  padding-top vw(28)
  box-sizing content-box
  border-radius 10px
  overflow hidden
  .base-section-components
    width 100%
    height 100%
    box-sizing border-box
    .base-section-components-border
      width vw(666)
      height vw(328)
      padding 0
      box-sizing border-box
  .horizontal-reward-container
    position absolute
    top vw(68)
    right 0
    left vw(30)
    width vw(658)
    height vw(256)
    padding-right vw(30)
  .horizontal-reward-item
    &.last-item
        margin-right vw(30)
.accelerate-reward-city-tag
  position absolute
  top vw(-22)
  right vw(20)
  width vw(110)
  height vw(109)
  background url('https://dpubstatic.udache.com/static/dpubimg/Tkh2FBJxCc/square_city_tag.png') center 0 no-repeat
  background-size contain
  transform rotateZ(20deg)
  .city-name
    position absolute
    top vw(22)
    left 50%
    transform translateX(-50%)
    box-sizing border-box
    overflow hidden
    color #ffa353
    white-space nowrap
    font-size vw(17)
    font-weight bold
</style>

<script type="application/json">
  {
    "component": true,
    "usingComponents": {
      "card-base": "../base",
      "horizontal-reward-container": "./horizontal-reward-container"
    }
  }
</script>
