<template>
  <view class="spring-festival-component intersectionRootNode" wx:ref="instance" wx:if="{{list.length}}" v-exposure@web="exposure">
    <view class="spring-icon"></view>
    <base-section title="{{title}}">
    <view class="box">
      <view wx:for="{{list}}" wx:key="index" class="notification-item">
        <view class="left-text">{{item.leftTxt}}</view>
        <rich-text
          class="right-text"
          nodes="{{item.rightTxt}}"
        />
      </view>
    </view>
    <view class="bottom-tip">
      <view class="left">{{ info.notice }}</view>
      <view class="right" bindtap="goDetail">查看详情</view>
      <view class="right-arrow"></view>
    </view>
    <view class="space"></view>
    </base-section>
  </view>
</template>

<script>
  import { createComponent } from '@mpxjs/core'
  import { trackAggregateEvent } from '../../common/js/Omega'
  import intersectionObserverMixin from '../../common/mixins/intersectionObserver'
  import { strToHtml } from '../../common/js/utils'
  import { universelPageJump } from '../../common/js/pageJump'

  createComponent({
    mixins: [intersectionObserverMixin],
    data: {
      intersectionEventId: 'wyc_main_venue_chunjie_sw' // 小程序模块出现在视口的埋点
    },
    properties: {
      info: {
        type: Object,
        value: {}
      }
    },
    computed: {
      title () {
        return this.info.title || ''
      },
      list () {
        const list = this.info.list || []
        return list.map(data => {
          const str = strToHtml(data.fee, '#ff7e33', 'font-weight:bold;font-size:16px;')
          return {
            leftTxt: data.date_text,
            rightTxt: str
          }
        })
      }
    },
    methods: {
      exposure () {
        trackAggregateEvent(this.intersectionEventId)
      },
      goDetail () {
        console.log(88)
        trackAggregateEvent('wyc_main_venue_chunjie_ck')
        const url = this.info.jump_url || ''
        const ret = universelPageJump(url)
        // 走客服会话逻辑
        if (ret === true) {
          this.triggerEvent('customerService')
        }
      }
    }
  })
</script>

<style lang="stylus">
  @import "../../common/stylus/mixin.styl"
  @import "../../common/stylus/base.styl"

  .spring-festival-component
    position relative
    margin-top 14px
    border-radius 10px
    .spring-icon
      position absolute
      top vw(10)
      left vw(10)
      width 35px
      height 35px
      background url('https://dpubstatic.udache.com/static/dpubimg/d92c964e-a791-4cb5-9baf-640e6f21fba5.png') center no-repeat
      background-size contain
      z-index 9
    .box
      background-color white
      padding 16px vw(38)
      border-1px(#F6D6B6, 7px)
      margin-top 2px
      border-radius 8px
      .notification-item:nth-child(even)
        background-color rgba(253,237,213,0.5)
    .notification-item
      display flex
      align-items center
      justify-content space-between
      padding 5.5px vw(27)
      background-color #fff
      margin-bottom 6px
      border-radius 30px
      font-size 14px
      .left-text
       color #B75E41
    .right-text
      font-size 14px
      line-height 17px
      color #FF7E33
    .space
      height 10px
      width 1px
      background-color transparent
    .bottom-tip
      width vw(516)
      position absolute
      display flex
      align-items center
      font-size 12px
      color #B75E41
      padding 6px 27px
      .left
        flex 1
      .right-arrow
        width 4.5px
        height 12px
        background: url('https://dpubstatic.udache.com/static/dpubimg/d0bb269c-6653-4f53-9b5d-76d6ccc03a05.png') center no-repeat
        background-size: contain
        margin-left 7px
        margin-top -2px
      .right
        position relative
        &::after
          content ''
          position absolute
          top -12px
          left -12px
          right -12px
          bottom -12px
</style>

<script type="application/json">
  {
    "component": true,
    "usingComponents": {
      "base-section": "./base"
    }
  }
</script>
