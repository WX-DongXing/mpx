<script>
import mpx, { createApp } from '@mpxjs/core'
import apiProxy from '@mpxjs/api-proxy'
import { RootStore, Omega } from '@didi/driver-biz-mp-sdk'
import toastMixin from './common/mixins/toast'
import hackMixin from './common/mixins/hack'
import Exposure from 'vue-exposure'
import VueConstructor from 'vue'

// TODO mock
import '../mock'

mpx.use(apiProxy, { usePromise: true })
mpx.mixin(toastMixin)
if (__mpx_mode__ === 'web') {
  mpx.mixin(hackMixin)
  // https://github.com/didi/mpx/releases/tag/v2.6.91
  // 暂不升级到 mpx 2.6.91
  VueConstructor.use(Exposure, {
    threshold: 0.5
  })
}

createApp({
  Omega,
  RootStore,
  onLaunch () {
  }
})
</script>

<style lang="stylus">
/*此处编写全局样式*/
@import "./common/stylus/base.styl"
</style>

<script name="json">
// 可以写注释，通过defs注入的常量做一些判断之类的操作-->
const pages = [
  './pages/index',
  './pages/group'
]

const packages = []

if (__mpx_mode__ !== 'web') {
  packages.push('@didi/mpx-login/src/app.mpx?root=login')
  packages.push('@didi/driver-biz-mp-sdk/lib/src/pages/index.mpx?root=driver-biz-mp-sdk')
  pages.push('./pages/webview-page/index.mpx')
}

module.exports = {
  pages,
  packages,
  permission: {
    'scope.userLocation': {
      desc: '获取你的位置信息后才能继续'
    }
  }
}
</script>
