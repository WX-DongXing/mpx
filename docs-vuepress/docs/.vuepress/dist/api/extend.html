<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>周边拓展 | Mpx框架</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="深度性能优化的增强型小程序开发框架">
    
    <link rel="preload" href="/assets/css/0.styles.9913be21.css" as="style"><link rel="preload" href="/assets/js/app.b3e4347f.js" as="script"><link rel="preload" href="/assets/js/6.831707e4.js" as="script"><link rel="preload" href="/assets/js/1.8362f1c2.js" as="script"><link rel="preload" href="/assets/js/21.7b33ed8c.js" as="script"><link rel="preload" href="/assets/js/7.d18ec5bf.js" as="script"><link rel="prefetch" href="/assets/js/10.fd0f5395.js"><link rel="prefetch" href="/assets/js/11.0d2e4af7.js"><link rel="prefetch" href="/assets/js/12.2c6c36bb.js"><link rel="prefetch" href="/assets/js/13.edbfa566.js"><link rel="prefetch" href="/assets/js/14.83ba8d76.js"><link rel="prefetch" href="/assets/js/15.6cf1dc24.js"><link rel="prefetch" href="/assets/js/16.417155c7.js"><link rel="prefetch" href="/assets/js/17.cc6e5111.js"><link rel="prefetch" href="/assets/js/18.b378d290.js"><link rel="prefetch" href="/assets/js/19.5c436eb1.js"><link rel="prefetch" href="/assets/js/2.e2289ad6.js"><link rel="prefetch" href="/assets/js/20.38a71dd8.js"><link rel="prefetch" href="/assets/js/22.d6b28d2e.js"><link rel="prefetch" href="/assets/js/23.1bb3d80b.js"><link rel="prefetch" href="/assets/js/24.1c6500e1.js"><link rel="prefetch" href="/assets/js/25.65058d3a.js"><link rel="prefetch" href="/assets/js/26.dd48289b.js"><link rel="prefetch" href="/assets/js/27.cd0763e3.js"><link rel="prefetch" href="/assets/js/28.677927d7.js"><link rel="prefetch" href="/assets/js/29.08cc9ede.js"><link rel="prefetch" href="/assets/js/30.61d2042c.js"><link rel="prefetch" href="/assets/js/31.361d3fef.js"><link rel="prefetch" href="/assets/js/32.30663c92.js"><link rel="prefetch" href="/assets/js/33.f30fdf06.js"><link rel="prefetch" href="/assets/js/34.45c1d2d3.js"><link rel="prefetch" href="/assets/js/35.607390b6.js"><link rel="prefetch" href="/assets/js/36.60cd9a9e.js"><link rel="prefetch" href="/assets/js/37.4f688e60.js"><link rel="prefetch" href="/assets/js/38.b47a446a.js"><link rel="prefetch" href="/assets/js/39.499aa852.js"><link rel="prefetch" href="/assets/js/4.1f2e8e96.js"><link rel="prefetch" href="/assets/js/40.bfacec42.js"><link rel="prefetch" href="/assets/js/41.140b5336.js"><link rel="prefetch" href="/assets/js/42.5bd54330.js"><link rel="prefetch" href="/assets/js/43.9d595a42.js"><link rel="prefetch" href="/assets/js/44.72af5911.js"><link rel="prefetch" href="/assets/js/45.2f2a87c3.js"><link rel="prefetch" href="/assets/js/46.2e5fdde3.js"><link rel="prefetch" href="/assets/js/47.f95e0062.js"><link rel="prefetch" href="/assets/js/48.e5029069.js"><link rel="prefetch" href="/assets/js/49.5de82fff.js"><link rel="prefetch" href="/assets/js/5.b5910773.js"><link rel="prefetch" href="/assets/js/50.0e800e46.js"><link rel="prefetch" href="/assets/js/51.9c9d4fae.js"><link rel="prefetch" href="/assets/js/52.03c99e23.js"><link rel="prefetch" href="/assets/js/53.f8ba4f1d.js"><link rel="prefetch" href="/assets/js/54.be8be90f.js"><link rel="prefetch" href="/assets/js/55.a697da32.js"><link rel="prefetch" href="/assets/js/56.ec7de33d.js"><link rel="prefetch" href="/assets/js/57.5ab60986.js"><link rel="prefetch" href="/assets/js/58.6d73f23b.js"><link rel="prefetch" href="/assets/js/59.c960b24a.js"><link rel="prefetch" href="/assets/js/60.aa0ee4b1.js"><link rel="prefetch" href="/assets/js/61.3fbe8717.js"><link rel="prefetch" href="/assets/js/62.fe55872e.js"><link rel="prefetch" href="/assets/js/63.94c76cd3.js"><link rel="prefetch" href="/assets/js/64.fbf9bb6c.js"><link rel="prefetch" href="/assets/js/65.e7240ed7.js"><link rel="prefetch" href="/assets/js/66.539127de.js"><link rel="prefetch" href="/assets/js/67.060c4e85.js"><link rel="prefetch" href="/assets/js/68.e4ee3984.js"><link rel="prefetch" href="/assets/js/69.06a4432a.js"><link rel="prefetch" href="/assets/js/8.465b2516.js"><link rel="prefetch" href="/assets/js/9.83220d36.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9913be21.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><div class="content-wrapper"><div class="container"><div class="theme-container"><header class="header" data-v-8e5e0702><!----> <div class="head-container" data-v-8e5e0702><a href="/" data-v-8e5e0702><div class="logo" data-v-8e5e0702>mpx</div></a> <div class="row" data-v-8e5e0702><div class="header__line" data-v-8e5e0702></div> <nav class="nav" data-v-8e5e0702><a href="/guide/basic/start.html" class="nav-link" data-v-8e5e0702>
          指南
          <!----></a></nav><nav class="nav" data-v-8e5e0702><a href="/api/config.html" class="nav-link" data-v-8e5e0702>
          API
          <!----></a></nav><nav class="nav" data-v-8e5e0702><a href="/articles/" class="nav-link" data-v-8e5e0702>
          文章
          <!----></a></nav><nav class="nav" data-v-8e5e0702><a href="https://github.com/didi/mpx/releases" class="nav-link" data-v-8e5e0702>
          更新记录
          <!----></a></nav><nav class="nav" data-v-8e5e0702><a href="https://github.com/didi/mpx" class="nav-link" data-v-8e5e0702>
          GitHub
          <!----></a></nav> <div class="searchBox-wrapper" data-v-8e5e0702><div class="searchBox" data-v-8e5e0702><form id="search-form" role="search" class="algolia-search-wrapper search-box" data-v-8e5e0702><div id="docsearch-container"></div></form></div></div></div></div> <!----></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/basic/start.html" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/api/config.html" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/articles/index.html" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="https://github.com/didi/mpx/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  更新记录
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/didi/mpx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/api/config.html" class="sidebar-link">全局配置</a></li><li><a href="/api/global-api.html" class="sidebar-link">全局api</a></li><li><a href="/api/instance-api.html" class="sidebar-link">实例api</a></li><li><a href="/api/directives.html" class="sidebar-link">模板指令</a></li><li><a href="/api/compile.html" class="sidebar-link">编译构建</a></li><li><a href="/api/builtIn.html" class="sidebar-link">内建组件</a></li><li><a href="/api/extend.html" aria-current="page" class="active sidebar-link">周边拓展</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/extend.html#mpx-fetch" class="sidebar-link">mpx-fetch</a></li><li class="sidebar-sub-header"><a href="/api/extend.html#api-proxy" class="sidebar-link">api-proxy</a></li><li class="sidebar-sub-header"><a href="/api/extend.html#webview-bridge" class="sidebar-link">webview-bridge</a></li><li class="sidebar-sub-header"><a href="/api/extend.html#mpx-mock" class="sidebar-link">mpx-mock</a></li><li class="sidebar-sub-header"><a href="/api/extend.html#size-report" class="sidebar-link">size-report</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="周边拓展"><a href="#周边拓展" class="header-anchor">#</a> 周边拓展</h1> <h2 id="mpx-fetch"><a href="#mpx-fetch" class="header-anchor">#</a> mpx-fetch</h2> <p>mpx-fetch提供了一个实例<strong>xfetch</strong> ，该实例包含以下api</p> <h3 id="fetch-config"><a href="#fetch-config" class="header-anchor">#</a> fetch(config)</h3> <blockquote><p>正常的promisify风格的请求方法</p></blockquote> <ul><li><p><strong>参数：</strong></p> <ul><li><p><code>{Object} config</code></p> <p>config 可指定以下属性：</p> <ul><li><p><strong>url</strong></p> <p>类型：<code>string</code></p> <p>设置请求url</p></li> <li><p><strong>method</strong></p> <p>类型：<code>string</code></p> <p>设置请求方式，默认为GET</p></li> <li><p><strong>data</strong></p> <p>类型：<code>Object</code></p> <p>设置请求参数</p></li> <li><p><strong>params</strong></p> <p>类型：<code>Object</code></p> <p>设置请求参数，参数会以 Query String 的形式进行传递</p></li> <li><p><strong>timeout</strong></p> <p>类型：<code>Number</code></p> <p>单位为毫秒。若不传，默认读取app.json文件中__networkTimeout属性。 对于超时的处理可在 catch 方法中进行</p></li> <li><p><strong>emulateJSON</strong></p> <p>类型：<code>Boolean</code></p> <p>设置为 true 时，等价于 header = {'content-type': 'application/x-www-form-urlencoded'}</p></li> <li><p><strong>usePre</strong>
类型：<code>Boolean</code>
预请求开关，若设置为 true，则两次请求间隔在有效期内且请求参数和请求方式对比一致的情况下，会返回上一次的请求结果</p></li> <li><p><strong>cacheInvalidationTime</strong>
类型： <code>number</code>
预请求缓存有效时长，单位 ms，默认为 5000ms。当两次请求时间间隔超过设置时长后再发起二次请求时，上一次的请求缓存会失效然后重新发起请求</p></li> <li><p><strong>ignorePreParamKeys</strong>
类型： <code>array</code> | <code>string</code>
在判断缓存请求是否可用对比前后两次请求参数时，默认对比的是 options 传入的所有参数（包括 params 和 data ）。但在具体业务场景下某些参数不一致时的缓存结果依旧可使用（比如参数中带有时间戳），所以提供 ignorePreParamKeys 来设置对比参数过程中可忽略的参数的 key，支持字符串数组和字符串（字符串传多个 key 时使用英文逗号分隔）类型。
配置后在进行参数对比时，不会对比在 ignorePreParamKeys 设置的参数。</p></li></ul></li></ul></li> <li><p><strong>示例：</strong></p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> mpx <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>
<span class="token keyword">import</span> mpxFetch <span class="token keyword">from</span> <span class="token string">'@mpxjs/fetch'</span>
mpx<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>mpxFetch<span class="token punctuation">)</span>
<span class="token comment">// 第一种访问形式</span>
mpx<span class="token punctuation">.</span>xfetch<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://xxx.com'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">10</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'test'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">emulateJSON</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usePre</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">cacheInvalidationTime</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ignorePreParamKeys</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'timestamp'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

mpx<span class="token punctuation">.</span><span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 第二种访问形式</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>$xfetch<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://test.com'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="canceltoken"><a href="#canceltoken" class="header-anchor">#</a> CancelToken</h3> <blockquote><p>命名导出，用于创建一个取消请求的凭证。</p></blockquote> <ul><li><strong>示例</strong>:</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> CancelToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/fetch'</span>
<span class="token keyword">const</span> cancelToken <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
mpx<span class="token punctuation">.</span>xfetch<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://xxx.com'</span><span class="token punctuation">,</span>
	<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'test'</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">cancelToken</span><span class="token operator">:</span> cancelToken<span class="token punctuation">.</span>token
<span class="token punctuation">}</span><span class="token punctuation">)</span>
cancelToken<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'手动取消请求'</span><span class="token punctuation">)</span> <span class="token comment">// 执行后请求中断，返回abort fail</span>
</code></pre></div><h3 id="xfetch"><a href="#xfetch" class="header-anchor">#</a> XFetch</h3> <blockquote><p>命名导出，用于创建一个新的mpx-fetch实例进行独立使用</p></blockquote> <ul><li><strong>示例</strong>:</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> XFetch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/fetch'</span>
<span class="token keyword">const</span> newFetch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XFetch</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token comment">// 生成新的mpx-fetch实例</span>
</code></pre></div><h3 id="interceptors"><a href="#interceptors" class="header-anchor">#</a> interceptors</h3> <blockquote><p>实例属性，用于添加拦截器，包含两个属性，request &amp; response</p></blockquote> <ul><li><strong>示例</strong>:</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>mpx<span class="token punctuation">.</span>xfetch<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
    <span class="token comment">// 也可以返回promise</span>
    <span class="token keyword">return</span> config
<span class="token punctuation">}</span><span class="token punctuation">)</span>
mpx<span class="token punctuation">.</span>xfetch<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token comment">// 也可以返回promise</span>
    <span class="token keyword">return</span> res
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="proxy-代理"><a href="#proxy-代理" class="header-anchor">#</a> proxy 代理</h3> <h4 id="setproxy"><a href="#setproxy" class="header-anchor">#</a> setProxy</h4> <blockquote><p>配置代理项，可以传入一个数组或者一个对象，请求会按设置的规则进行代理</p></blockquote> <ul><li><p><strong>参数：</strong></p> <p>类型： <code>{Array | Object}</code></p> <ul><li><p><strong>test</strong></p> <p>类型：<code>object</code></p> <ul><li><p>url</p> <p>类型：<code>string</code></p> <p>详细：全路径匹配，规则可以参考<a href="https://www.npmjs.com/package/path-to-regexp" target="_blank" rel="noopener noreferrer">path-to-regexp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，也可参考下面的简单示例。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>如果设置了此项，则 protocol、host、port、path 规则不再生效。此项支持 path-to-regexp 匹配，protocol、host、port、path 为全等匹配。</p></div></li> <li><p>protocol</p> <p>类型：<code>string</code></p> <p>详细：待匹配的协议头</p></li> <li><p>host</p> <p>类型：<code>string</code></p> <p>详细：不包含端口的 host</p></li> <li><p>port</p> <p>类型：<code>string</code></p> <p>详细：待匹配的端口</p></li> <li><p>path</p> <p>类型：<code>string</code></p> <p>详细：待匹配的路径</p></li> <li><p>params</p> <p>类型：<code>object</code></p> <p>详细：同时匹配请求中的 <code>params</code> 和 <code>query</code></p></li> <li><p>data</p> <p>类型：<code>object</code></p> <p>详细：匹配请求中的 <code>data</code></p></li> <li><p>header</p> <p>类型：<code>object</code></p> <p>详细：匹配请求中的 <code>header</code></p></li> <li><p>method</p> <p>类型：<code>Method | Method[]</code></p> <p>详细：匹配请求方法，不区分大小写，可以传一个方法，也可以传一个方法数组</p></li> <li><p>custom</p> <p>类型：<code>function</code></p> <p>详细：自定义匹配规则，参数会注入原始请求配置，结果需返回 <code>true</code> 或 <code>false</code></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>如果设置了此项，匹配结果以此项为准，以上规则均不再生效。</p></div></li></ul></li> <li><p><strong>proxy</strong></p> <p>类型：<code>object</code></p> <ul><li><p>url</p> <p>类型：<code>string</code></p> <p>详细：代理的 url</p></li> <li><p>protocol</p> <p>类型：<code>string</code></p> <p>详细：修改原请求的协议头</p></li> <li><p>host</p> <p>类型：<code>string</code></p> <p>详细：代理的 host，不包含端口号</p></li> <li><p>port</p> <p>类型：<code>string</code></p> <p>详细：修改端口号</p></li> <li><p>path</p> <p>类型：<code>string</code></p> <p>详细：修改原请求路径</p></li> <li><p>params</p> <p>类型：<code>object</code></p> <p>详细：合并原请求的 params</p></li> <li><p>data</p> <p>类型：<code>object</code></p> <p>详细：合并原请求的 data</p></li> <li><p>header</p> <p>类型：<code>object</code></p> <p>详细：合并原请求的 header</p></li> <li><p>method</p> <p>类型：<code>Method</code></p> <p>详细：替换原请求的方法</p></li> <li><p>custom</p> <p>类型：<code>function</code></p> <p>详细：自定义代理规则，会注入两个参数，第一个是上一个匹配规则处理后的请求配置，第二个是 match 的参数对象，结果需返回要修改的请求配置对象。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>如果设置了此项，最终代理配置将以此项为准，其他配置规则均不再生效。</p></div></li></ul></li> <li><p><strong>waterfall</strong></p> <p>类型：<code>boolean</code></p> <p>详细：默认为 <code>false</code>，为 <code>false</code> 时，命中当前规则处理完就直接返回；为 <code>true</code> 时，命中当前匹配规则处理完成后将结果传递给下面命中匹配规则继续处理。</p></li></ul></li> <li><p><strong>示例：</strong></p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>mpx<span class="token punctuation">.</span>xfetch<span class="token punctuation">.</span><span class="token function">setProxy</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 此项匹配之后，会按下面 proxy 配置的修改请求配置</span>
		<span class="token literal-property property">header</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">'content-type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">test1</span><span class="token operator">:</span> <span class="token string">'abc'</span>
        <span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">header</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token string">'env test'</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">test2</span><span class="token operator">:</span> <span class="token string">'cba'</span>
        <span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">waterfall</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 为 true 时会将此次修改后的请求配置继续传递给下面的规则处理</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">// 可以分别单独匹配 protocol、host、port、path；代理规则同样</span>
        <span class="token literal-property property">protocol</span><span class="token operator">:</span> <span class="token string">'http:'</span><span class="token punctuation">,</span>
		<span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'mock.didi.com'</span><span class="token punctuation">,</span>
		<span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
		<span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/mock/test'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'test.didi.com'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8888</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">waterfall</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 自定义匹配规则</span>
        <span class="token function">custom</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// config 为原始的请求配置</span>
            <span class="token comment">// 自定义匹配逻辑</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>xxx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span>
		<span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 自定义代理配置</span>
        <span class="token function">custom</span> <span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// config 为上面匹配后修改过的请求配置</span>
            <span class="token comment">// params 为 match 后的参数对象</span>
            <span class="token comment">// 返回需要修改的请求配置对象</span>
			<span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">3</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
					<span class="token literal-property property">test3</span><span class="token operator">:</span> <span class="token string">'aaa'</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">waterfall</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// : 可以匹配目标项，并将 match 结果返回到代理 custom 函数中</span>
        <span class="token comment">// :和?都属于保留符号，若不想做匹配时需用 '\\' 转义</span>
        <span class="token comment">// (.*)为全匹配</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">':protocol\\://mock.didi.com/mock/:id/oneapi/router/forum/api/v1/(.*)'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'post'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://127.0.0.1:8080/go/into/$id/api/v2/abcd'</span> <span class="token comment">// '$'项在代理生效后会替换匹配规则中的':'项</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">waterfall</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// false 时不会继续匹配后面的规则</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="prependproxy"><a href="#prependproxy" class="header-anchor">#</a> prependProxy</h4> <blockquote><p>向前追加代理规则</p></blockquote> <ul><li><strong>示例：</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>mpx<span class="token punctuation">.</span>xfetch<span class="token punctuation">.</span><span class="token function">prependProxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">waterfall</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="appendproxy"><a href="#appendproxy" class="header-anchor">#</a> appendProxy</h4> <blockquote><p>向后追加代理规则</p></blockquote> <ul><li><strong>示例：</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>mpx<span class="token punctuation">.</span>xfetch<span class="token punctuation">.</span><span class="token function">appendProxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">waterfall</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="getproxy"><a href="#getproxy" class="header-anchor">#</a> getProxy</h4> <blockquote><p>查看已有的代理配置</p></blockquote> <ul><li><strong>示例：</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mpx<span class="token punctuation">.</span>xfetch<span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="clearproxy"><a href="#clearproxy" class="header-anchor">#</a> clearProxy</h4> <blockquote><p>解除所有的代理配置</p></blockquote> <ul><li><strong>示例：</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>mpx<span class="token punctuation">.</span>xfetch<span class="token punctuation">.</span><span class="token function">clearProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="api-proxy"><a href="#api-proxy" class="header-anchor">#</a> api-proxy</h2> <p>Mpx目前已经支持的API转换列表，供参考</p> <table><thead><tr><th>方法/平台</th> <th style="text-align:center;">wx</th> <th style="text-align:center;">ali</th> <th style="text-align:center;">web</th></tr></thead> <tbody><tr><td>getSystemInfo</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>getSystemInfoSync</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>nextTick</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>showToast</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>hideToast</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>showModal</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>showLoading</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>hideLoading</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>showActionSheet</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>showNavigationBarLoading</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>hideNavigationBarLoading</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>setNavigationBarTitle</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>setNavigationBarColor</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>request</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>downloadFile</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>uploadFile</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>setStorageSync</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>removeStorageSync</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>getStorageSync</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>saveImageToPhotosAlbum</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>previewImage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>compressImage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>chooseImage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>getLocation</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>saveFile</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>removeSavedFile</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>getSavedFileList</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>getSavedFileInfo</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>addPhoneContact</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>setClipboardData</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>getClipboardData</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>setScreenBrightness</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>getScreenBrightness</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>makePhoneCall</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>stopAccelerometer</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>startAccelerometer</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>stopCompass</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>startCompass</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>stopGyroscope</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>startGyroscope</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>scanCode</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>login</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>checkSession</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>getUserInfo</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>requestPayment</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>createCanvasContext</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>canvasToTempFilePath</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>canvasPutImageData</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>canvasGetImageData</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>createSelectorQuery</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>onWindowResize</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>offWindowResize</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>arrayBufferToBase64</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">✅</td></tr> <tr><td>base64ToArrayBuffer</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">✅</td></tr></tbody></table> <h2 id="webview-bridge"><a href="#webview-bridge" class="header-anchor">#</a> webview-bridge</h2> <p>Mpx 支持小程序跨平台后，多个平台的小程序里都提供了 webview 组件，webview 打开的 H5 页面可以通过小程序提供的 API 来与小程序通信以及调用一些小程序的能力，但是各家小程序对于 webview 提供的API是不一样的。</p> <p>比如微信的 webview 打开的 H5 页面里是通过调用 wx.miniProgram.navigateTo 来跳转到原生小程序页面的，而在支付宝是通过调用 my.navigateTo 来实现跳转的，那么我们开发 H5 时候为了让 H5 能适应各家小程序平台就需要写多份对应逻辑。</p> <p>为解决这个问题，Mpx 提供了抹平平台差异的bridge库：@mpxjs/webview-bridge。</p> <p><strong>安装：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>npm install @mpxjs<span class="token operator">/</span>webview<span class="token operator">-</span>bridge
</code></pre></div><p><strong>使用：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> mpx <span class="token keyword">from</span> <span class="token string">'@mpxjs/webview-bridge'</span>
mpx<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
mpx<span class="token punctuation">.</span>env <span class="token comment">// 输出：wx/qq/ali/baidu/tt</span>
mpx<span class="token punctuation">.</span><span class="token function">checkJSApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>cdn地址引用：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 开发环境版本，方便调试 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;https://dpubstatic.udache.com/static/dpubimg/D2JeLyT0_Y/2.2.43.webviewbridge.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 生产环境版本，压缩了体积 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;https://dpubstatic.udache.com/static/dpubimg/PRg145LZ-i/2.2.43.webviewbridge.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>


<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 同时支持 <span class="token constant">ES</span> Module 引入的 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token comment">// index.html</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;module&quot;</span> src<span class="token operator">=</span><span class="token string">&quot;https://dpubstatic.udache.com/static/dpubimg/6MQOo-ocI4/2.2.43.webviewbridge.esm.browser.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token comment">// main.js</span>
<span class="token keyword">import</span> mpx <span class="token keyword">from</span> <span class="token string">&quot;https://dpubstatic.udache.com/static/dpubimg/6MQOo-ocI4/2.2.43.webviewbridge.esm.browser.min.js&quot;</span>

<span class="token comment">//ES Module 开发版本地址： https://dpubstatic.udache.com/static/dpubimg/cdhpNhmWmJ/2.2.43.webviewbridge.esm.browser.js</span>
</code></pre></div><p><strong>基础方法提供：</strong></p> <table><thead><tr><th>方法/平台</th> <th style="text-align:center;">wx</th> <th style="text-align:center;">qq</th> <th style="text-align:center;">ali</th> <th style="text-align:center;">baidu</th> <th style="text-align:right;">tt</th></tr></thead> <tbody><tr><td>navigateTo</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">✅</td></tr> <tr><td>navigateBack</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">✅</td></tr> <tr><td>switchTab</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">✅</td></tr> <tr><td>reLaunch</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">✅</td></tr> <tr><td>redirectTo</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">✅</td></tr> <tr><td>getEnv</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">✅</td></tr> <tr><td>postMessage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">✅</td></tr> <tr><td>getLoadError</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">✅</td></tr> <tr><td>onMessage</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr></tbody></table> <p><strong>扩展方法提供：</strong></p> <table><thead><tr><th>方法/平台</th> <th style="text-align:center;">wx</th> <th style="text-align:center;">qq</th> <th style="text-align:center;">ali</th> <th style="text-align:center;">baidu</th> <th style="text-align:right;">tt</th></tr></thead> <tbody><tr><td>checkJSApi</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>chooseImage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">❌</td></tr> <tr><td>previewImage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">❌</td></tr> <tr><td>uploadImage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>downloadImage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>getLocalImgData</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>startRecord</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>stopRecord</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>onVoiceRecordEnd</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>playVoice</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>pauseVoice</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>stopVoice</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>onVoicePlayEnd</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>uploadVoice</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>downloadVoice</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>translateVoice</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>getNetworkType</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">❌</td></tr> <tr><td>openLocation</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">❌</td></tr> <tr><td>getLocation</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">❌</td></tr> <tr><td>stopSearchBeacons</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>onSearchBeacons</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>scanQRCode</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>chooseCard</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>addCard</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>openCard</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>alert</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;"></td> <td style="text-align:right;"></td></tr> <tr><td>showLoading</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;"></td> <td style="text-align:right;"></td></tr> <tr><td>hideLoading</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;"></td> <td style="text-align:right;"></td></tr> <tr><td>setStorage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;"></td> <td style="text-align:right;"></td></tr> <tr><td>getStorage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;"></td> <td style="text-align:right;"></td></tr> <tr><td>removeStorage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;"></td> <td style="text-align:right;"></td></tr> <tr><td>clearStorage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;"></td> <td style="text-align:right;"></td></tr> <tr><td>getStorageInfo</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;"></td> <td style="text-align:right;"></td></tr> <tr><td>startShare</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;"></td> <td style="text-align:right;"></td></tr> <tr><td>tradePay</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;"></td> <td style="text-align:right;"></td></tr> <tr><td>onMessage</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr></tbody></table> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>这个库仅提供给 H5 使用，请勿在小程序环境引入</p></div> <h2 id="mpx-mock"><a href="#mpx-mock" class="header-anchor">#</a> mpx-mock</h2> <ul><li>请参考 <a href="/guide/extend/mock.html">数据 mock</a></li></ul> <h3 id="使用参数校验功能"><a href="#使用参数校验功能" class="header-anchor">#</a> 使用参数校验功能</h3> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>参数校验功能会阻断xfetch发送请求,建议在测试阶段使用</p></div> <h4 id="setvalidator"><a href="#setvalidator" class="header-anchor">#</a> setValidator</h4> <blockquote><p>配置校验规则，可以自定义，也可以根据以下规则传入一个数组</p></blockquote> <ul><li><p><strong>参数：</strong></p> <p>类型  <code>Array</code></p> <ul><li><p><strong>test</strong></p></li> <li><p>类型：<code>{object | function}</code></p> <ul><li><p>url</p> <p>类型：<code>string</code></p> <p>详细：全路径匹配，规则可以参考<a href="https://www.npmjs.com/package/path-to-regexp" target="_blank" rel="noopener noreferrer">path-to-regexp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，也可参考下面的简单示例。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>如果设置了此项，则 protocol、host、port、path 规则不再生效。此项支持 path-to-regexp 匹配，protocol、host、port、path 为全等匹配。</p></div></li> <li><p>protocol</p> <p>类型：<code>string</code></p> <p>详细：待匹配的协议头</p></li> <li><p>host</p> <p>类型：<code>string</code></p> <p>详细：不包含端口的 host</p></li> <li><p>port</p> <p>类型：<code>string</code></p> <p>详细：待匹配的端口</p></li> <li><p>path</p> <p>类型：<code>string</code></p> <p>详细：待匹配的路径</p></li> <li><p>params</p> <p>类型：<code>object</code></p> <p>详细：同时匹配请求中的 <code>params</code> 和 <code>query</code></p></li> <li><p>data</p> <p>类型：<code>object</code></p> <p>详细：匹配请求中的 <code>data</code></p></li> <li><p>header</p> <p>类型：<code>object</code></p> <p>详细：匹配请求中的 <code>header</code></p></li> <li><p>method</p> <p>类型：<code>Method | Method[]</code></p> <p>详细：匹配请求方法，不区分大小写，可以传一个方法，也可以传一个方法数组</p></li> <li><p>custom</p> <p>类型：<code>function</code></p> <p>详细：自定义匹配规则，参数会注入原始请求配置，结果需返回 <code>true</code> 或 <code>false</code></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>如果设置了此项，匹配结果以此项为准，以上规则均不再生效。</p></div></li></ul></li> <li><p><strong>validator</strong></p></li> <li><p>类型: <code>{object}</code></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>object类型有两种配置方式，第一种是区分params(一般对应get请求)和data(一般对应post/put请求)分别配置，第二种不区分两种请求配置，如果不分开配置所有参数不区分请求方式全部校验，详情请看以下示例。
function类型为自定义配置,第一个参数是接口请求的参数以及url,请求方法等
注：post请求会校验params和data get请求会校验params</p></div> <ul><li><p>params
类型：<code>object</code>
详细：参数对象</p> <ul><li>type
类型:  <code>{ Array | string }</code>
详细：Array类型时支持多种类型校验，type支持的类型有基本类型、enum(枚举值)、any(默认不校验)</li> <li>require
类型：<code>boolean</code>
详细：参数是否必须</li> <li>include
类型：<code>Array</code>
详细： 枚举类型校验时提供</li></ul></li> <li><p>data
类型：<code>object</code>
详细：参数对象</p> <ul><li>type
类型:  <code>{ Array | string }</code>
详细：Array类型时支持多种类型校验，type支持的类型有基本类型、enum(枚举值)、any(默认不校验)</li> <li>require
类型：<code>boolean</code>
详细：参数是否必须</li> <li>include
类型：<code>Array</code>
详细： 枚举类型校验时提供</li></ul></li> <li><p>custom</p> <p>类型：<code>function</code></p> <p>详细：自定义校验规则，会注入一个参数，是上一个匹配规则处理后的请求配置</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>如果设置了此项，最终代理配置将以此项为准，其他配置规则均不再生效。</p></div> <ul><li><strong>自定义校验规则返回数据的格式</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">ValidatorRes</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">valid</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span>
  <span class="token literal-property property">message</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">validatorCustom</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">config</span><span class="token operator">:</span>Config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> boolean｜ValidatorRes
</code></pre></div></li></ul></li> <li><p><strong>greedy</strong>
是否默认校验所有参数 没有这个属性或者属性值为true时校验所有参数，否则校验填写校验规则的参数值</p></li></ul></li></ul> <h4 id="getvalidator"><a href="#getvalidator" class="header-anchor">#</a> getValidator</h4> <blockquote><p>返回所有校验规则</p></blockquote> <ul><li><strong>示例</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>
mpx<span class="token punctuation">.</span>xfetch<span class="token punctuation">.</span><span class="token function">setValidator</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">protocol</span><span class="token operator">:</span> <span class="token string">'https:'</span><span class="token punctuation">,</span><span class="token comment">// 配置协议</span>
      <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'xxx.com'</span><span class="token punctuation">,</span><span class="token comment">// 配置域名</span>
      <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment">// 配置端口</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/app'</span><span class="token punctuation">,</span><span class="token comment">// 配置路径</span>
      <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'GET'</span><span class="token comment">// 配置请求方法</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">validator</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// validator直接配置参数 无论是post请求还是get请求校验所有参数</span>
      <span class="token literal-property property">lang</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">project_id</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'number'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">phone</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token string">'number'</span><span class="token punctuation">]</span> <span class="token comment">//支持多个类型</span>
        <span class="token literal-property property">require</span><span class="token operator">:</span><span class="token boolean">true</span> <span class="token comment">// 属性是否必须</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">platform_type</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'enum'</span><span class="token punctuation">,</span><span class="token comment">//支持枚举类型校验</span>
        <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">greedy</span><span class="token operator">:</span><span class="token boolean">false</span> <span class="token comment">// 是否校验所有参数 不写这个属性或属性值为true校验所有参数</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">protocol</span><span class="token operator">:</span> <span class="token string">'https:'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'xxxx.com'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/app'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">validator</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// validator配置不同请求的参数 post校验params和data get校验params</span>
      <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">custom</span><span class="token operator">:</span> testCustom <span class="token comment">// 自定义匹配规则 必须是方法</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">validator</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">custom</span><span class="token operator">:</span> validatorCustom <span class="token comment">// 自定义校验规则 必须是方法</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="size-report"><a href="#size-report" class="header-anchor">#</a> size-report</h2> <p>Mpx框架项目包体积可以进行分组、分包、页面、冗余Npm包等维度的分析和对比，详细<a href="/advance/size-report.html">请见</a></p> <h3 id="插件配置项"><a href="#插件配置项" class="header-anchor">#</a> 插件配置项</h3> <ul><li><p><strong>server</strong></p> <p>类型：<code>object</code></p> <p>详细：本地可视化服务相关配置</p></li> <li><p><strong>filename</strong></p> <p>类型：<code>string</code></p> <p>详细：构建生成的包体积详细输出文件地址</p></li> <li><p><strong>threshold</strong></p> <p>类型：<code>object</code></p> <p>详细：配置项目总体积和分包体积阈值，包含两个字段，size 为项目总体积阈值，packages 为分包体积阈值</p> <p>示例:</p> <div class="language-html extra-class"><pre class="language-html"><code>{
   size: '16MB', // 项目总包体积限额 16M
   packages: '2MB' // 项目每个分包体积限额 2M
}
</code></pre></div></li> <li><p><strong>groups</strong></p> <p>类型：<code>Array&lt;object&gt;</code></p> <p>详细：配置体积计算分组，以输入分组为维度对体积进行分析，当没有该配置时结果中将不会包含分组体积信息</p> <ul><li><p>name</p> <p>类型：<code>string</code></p> <p>详细：分组名称</p></li> <li><p>threshold</p> <p>类型：<code>string | object</code></p> <p>详细：分组相关体积阈值，若不配置则该分组不校验体积阈值，同时也支持对分组中占各分包体积阈值</p> <p>示例：</p> <div class="language-html extra-class"><pre class="language-html"><code>// 分组体积限额 500KB
threshold: '500KB'
// 或者如下方，分组体积限额500KB，分组占主包体积限额160KB
threshold: {
  size: '500KB',
  packages: {
    main: '160KB'
  }
}
</code></pre></div></li> <li><p>entryRules</p> <p>类型：<code>object</code></p> <p>详细：配置分组 entry 匹配规则，小程序中所有的页面和组件都可被视为 entry</p> <ul><li>include: 包含符合条件的入口文件，默认为空数组，规则数组中支持函数、正则、字符串</li> <li>exclude: 剔除符合条件的入口文件，默认为空数组，规则数组中支持函数、正则、字符串</li></ul> <p>示例：</p> <div class="language-html extra-class"><pre class="language-html"><code>include: [/@someGroup\/some-npm-package/],
exclude: [/@someGroup\/some-two-pack/]
</code></pre></div></li> <li><p>noEntryRules</p> <p>类型：<code>object</code></p> <p>详细：配置计算分组中纯 js 入口引入的体积（不包含组件和页面）</p> <ul><li>include: 包含符合条件的 js 文件，默认为空数组，规则数组中支持函数、正则、字符串</li> <li>exclude: 剔除符合条件的 js 文件，默认为空数组，规则数组中支持函数、正则、字符串</li></ul> <p>示例：</p> <div class="language-html extra-class"><pre class="language-html"><code>include: [/@someGroup\/some-npm-package/],
exclude: [/@someGroup\/some-two-pack/]
</code></pre></div></li></ul></li> <li><p><strong>reportPages</strong></p> <p>类型：<code>boolean</code></p> <p>详细：是否收集页面维度体积详情，默认 false</p></li> <li><p><strong>reportAssets</strong></p> <p>类型：<code>boolean</code></p> <p>详细：是否收集资源维度体积详情，默认 false</p></li> <li><p><strong>reportRedundance</strong></p> <p>类型：<code>boolean</code></p> <p>详细：是否收集冗余资源，默认 false</p></li> <li><p><strong>showEntrysPackages</strong></p> <p>类型：<code>Array&lt;string&gt;</code></p> <p>详细：展示某些分包资源的引用来源信息，例如 ['main'] 为查看主包资源的引用来源信息，默认为 []</p></li></ul> <p>配置使用示例：</p> <div class="language-html extra-class"><pre class="language-html"><code>{
  // 本地可视化服务相关配置
  server: {
    enable: true, // 是否启动本地服务，非必填，默认 true
    autoOpenBrowser: true, // 是否自动打开可视化平台页面，非必填，默认 true
    port: 0, // 本地服务端口，非必填，默认 0(随机端口)
    host: '127.0.0.1', // 本地服务host，非必填
  },
  // 体积报告生成后输出的文件地址名，路径相对为 dist/wx 或者 dist/ali
  filename: '../report.json',
  // 配置阈值，此处代表总包体积阈值为 16MB，分包体积阈值为 2MB，超出将会触发编译报错提醒，该报错不阻断构建
  threshold: {
    size: '16MB',
    packages: '2MB'
  },
  // 配置体积计算分组，以输入分组为维度对体积进行分析，当没有该配置时结果中将不会包含分组体积信息
  groups: [
    {
      // 分组名称
      name: 'vant',
      // 配置分组 entry 匹配规则，小程序中所有的页面和组件都可被视为 entry，如下所示的分组配置将计算项目中引入的 vant 组件带来的体积占用
      entryRules: {
        include: '@vant/weapp'
      }
    },
    {
      name: 'pageGroup',
      // 每个分组中可分别配置阈值，如果不配置则表示
      threshold: '500KB',
      entryRules: {
        include: ['src/pages/index', 'src/pages/user']
      }
    },
    {
      name: 'someSdk',
      entryRules: {
        include: ['@somegroup/someSdk/index', '@somegroup/someSdk2/index']
      },
      // 有的时候你可能希望计算纯 js 入口引入的体积（不包含组件和页面），这种情况下需要使用 noEntryModules
      noEntryModules: {
        include: 'src/lib/sdk.js'
      }
    }
  ],
  // 是否收集页面维度体积详情，默认 false
  reportPages: true,
  // 是否收集资源维度体积详情，默认 false
  reportAssets: true,
  // 是否收集冗余资源，默认 false
  reportRedundance: true,
  // 展示某些分包资源的引用来源信息，默认为 []
  showEntrysPackages: ['main']
}
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/api/builtIn.html" class="prev">
        内建组件
      </a></span> <!----></p></div> </main></div></div></div></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.b3e4347f.js" defer></script><script src="/assets/js/6.831707e4.js" defer></script><script src="/assets/js/1.8362f1c2.js" defer></script><script src="/assets/js/21.7b33ed8c.js" defer></script><script src="/assets/js/7.d18ec5bf.js" defer></script>
  </body>
</html>
