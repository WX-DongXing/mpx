<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>全局api | Mpx框架</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="深度性能优化的增强型小程序开发框架">
    
    <link rel="preload" href="/assets/css/0.styles.9913be21.css" as="style"><link rel="preload" href="/assets/js/app.b3e4347f.js" as="script"><link rel="preload" href="/assets/js/6.831707e4.js" as="script"><link rel="preload" href="/assets/js/1.8362f1c2.js" as="script"><link rel="preload" href="/assets/js/22.d6b28d2e.js" as="script"><link rel="preload" href="/assets/js/7.d18ec5bf.js" as="script"><link rel="prefetch" href="/assets/js/10.fd0f5395.js"><link rel="prefetch" href="/assets/js/11.0d2e4af7.js"><link rel="prefetch" href="/assets/js/12.2c6c36bb.js"><link rel="prefetch" href="/assets/js/13.edbfa566.js"><link rel="prefetch" href="/assets/js/14.83ba8d76.js"><link rel="prefetch" href="/assets/js/15.6cf1dc24.js"><link rel="prefetch" href="/assets/js/16.417155c7.js"><link rel="prefetch" href="/assets/js/17.cc6e5111.js"><link rel="prefetch" href="/assets/js/18.b378d290.js"><link rel="prefetch" href="/assets/js/19.5c436eb1.js"><link rel="prefetch" href="/assets/js/2.e2289ad6.js"><link rel="prefetch" href="/assets/js/20.38a71dd8.js"><link rel="prefetch" href="/assets/js/21.7b33ed8c.js"><link rel="prefetch" href="/assets/js/23.1bb3d80b.js"><link rel="prefetch" href="/assets/js/24.1c6500e1.js"><link rel="prefetch" href="/assets/js/25.65058d3a.js"><link rel="prefetch" href="/assets/js/26.dd48289b.js"><link rel="prefetch" href="/assets/js/27.cd0763e3.js"><link rel="prefetch" href="/assets/js/28.677927d7.js"><link rel="prefetch" href="/assets/js/29.08cc9ede.js"><link rel="prefetch" href="/assets/js/30.61d2042c.js"><link rel="prefetch" href="/assets/js/31.361d3fef.js"><link rel="prefetch" href="/assets/js/32.30663c92.js"><link rel="prefetch" href="/assets/js/33.f30fdf06.js"><link rel="prefetch" href="/assets/js/34.45c1d2d3.js"><link rel="prefetch" href="/assets/js/35.607390b6.js"><link rel="prefetch" href="/assets/js/36.60cd9a9e.js"><link rel="prefetch" href="/assets/js/37.4f688e60.js"><link rel="prefetch" href="/assets/js/38.b47a446a.js"><link rel="prefetch" href="/assets/js/39.499aa852.js"><link rel="prefetch" href="/assets/js/4.1f2e8e96.js"><link rel="prefetch" href="/assets/js/40.bfacec42.js"><link rel="prefetch" href="/assets/js/41.140b5336.js"><link rel="prefetch" href="/assets/js/42.5bd54330.js"><link rel="prefetch" href="/assets/js/43.9d595a42.js"><link rel="prefetch" href="/assets/js/44.72af5911.js"><link rel="prefetch" href="/assets/js/45.2f2a87c3.js"><link rel="prefetch" href="/assets/js/46.2e5fdde3.js"><link rel="prefetch" href="/assets/js/47.f95e0062.js"><link rel="prefetch" href="/assets/js/48.e5029069.js"><link rel="prefetch" href="/assets/js/49.5de82fff.js"><link rel="prefetch" href="/assets/js/5.b5910773.js"><link rel="prefetch" href="/assets/js/50.0e800e46.js"><link rel="prefetch" href="/assets/js/51.9c9d4fae.js"><link rel="prefetch" href="/assets/js/52.03c99e23.js"><link rel="prefetch" href="/assets/js/53.f8ba4f1d.js"><link rel="prefetch" href="/assets/js/54.be8be90f.js"><link rel="prefetch" href="/assets/js/55.a697da32.js"><link rel="prefetch" href="/assets/js/56.ec7de33d.js"><link rel="prefetch" href="/assets/js/57.5ab60986.js"><link rel="prefetch" href="/assets/js/58.6d73f23b.js"><link rel="prefetch" href="/assets/js/59.c960b24a.js"><link rel="prefetch" href="/assets/js/60.aa0ee4b1.js"><link rel="prefetch" href="/assets/js/61.3fbe8717.js"><link rel="prefetch" href="/assets/js/62.fe55872e.js"><link rel="prefetch" href="/assets/js/63.94c76cd3.js"><link rel="prefetch" href="/assets/js/64.fbf9bb6c.js"><link rel="prefetch" href="/assets/js/65.e7240ed7.js"><link rel="prefetch" href="/assets/js/66.539127de.js"><link rel="prefetch" href="/assets/js/67.060c4e85.js"><link rel="prefetch" href="/assets/js/68.e4ee3984.js"><link rel="prefetch" href="/assets/js/69.06a4432a.js"><link rel="prefetch" href="/assets/js/8.465b2516.js"><link rel="prefetch" href="/assets/js/9.83220d36.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9913be21.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><div class="content-wrapper"><div class="container"><div class="theme-container"><header class="header" data-v-8e5e0702><!----> <div class="head-container" data-v-8e5e0702><a href="/" data-v-8e5e0702><div class="logo" data-v-8e5e0702>mpx</div></a> <div class="row" data-v-8e5e0702><div class="header__line" data-v-8e5e0702></div> <nav class="nav" data-v-8e5e0702><a href="/guide/basic/start.html" class="nav-link" data-v-8e5e0702>
          指南
          <!----></a></nav><nav class="nav" data-v-8e5e0702><a href="/api/config.html" class="nav-link" data-v-8e5e0702>
          API
          <!----></a></nav><nav class="nav" data-v-8e5e0702><a href="/articles/" class="nav-link" data-v-8e5e0702>
          文章
          <!----></a></nav><nav class="nav" data-v-8e5e0702><a href="https://github.com/didi/mpx/releases" class="nav-link" data-v-8e5e0702>
          更新记录
          <!----></a></nav><nav class="nav" data-v-8e5e0702><a href="https://github.com/didi/mpx" class="nav-link" data-v-8e5e0702>
          GitHub
          <!----></a></nav> <div class="searchBox-wrapper" data-v-8e5e0702><div class="searchBox" data-v-8e5e0702><form id="search-form" role="search" class="algolia-search-wrapper search-box" data-v-8e5e0702><div id="docsearch-container"></div></form></div></div></div></div> <!----></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/basic/start.html" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/api/config.html" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/articles/index.html" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="https://github.com/didi/mpx/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  更新记录
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/didi/mpx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/api/config.html" class="sidebar-link">全局配置</a></li><li><a href="/api/global-api.html" aria-current="page" class="active sidebar-link">全局api</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/global-api.html#createapp" class="sidebar-link">createApp</a></li><li class="sidebar-sub-header"><a href="/api/global-api.html#createpage" class="sidebar-link">createPage</a></li><li class="sidebar-sub-header"><a href="/api/global-api.html#createcomponent" class="sidebar-link">createComponent</a></li><li class="sidebar-sub-header"><a href="/api/global-api.html#createstore" class="sidebar-link">createStore</a></li><li class="sidebar-sub-header"><a href="/api/global-api.html#createstorewiththis" class="sidebar-link">createStoreWithThis</a></li><li class="sidebar-sub-header"><a href="/api/global-api.html#createstatewiththis" class="sidebar-link">createStateWithThis</a></li><li class="sidebar-sub-header"><a href="/api/global-api.html#creategetterswiththis" class="sidebar-link">createGettersWithThis</a></li><li class="sidebar-sub-header"><a href="/api/global-api.html#createmutationswiththis" class="sidebar-link">createMutationsWithThis</a></li><li class="sidebar-sub-header"><a href="/api/global-api.html#createactionswiththis" class="sidebar-link">createActionsWithThis</a></li><li class="sidebar-sub-header"><a href="/api/global-api.html#mixin" class="sidebar-link">mixin</a></li><li class="sidebar-sub-header"><a href="/api/global-api.html#injectmixins" class="sidebar-link">injectMixins</a></li><li class="sidebar-sub-header"><a href="/api/global-api.html#topureobject" class="sidebar-link">toPureObject</a></li><li class="sidebar-sub-header"><a href="/api/global-api.html#observable" class="sidebar-link">observable</a></li><li class="sidebar-sub-header"><a href="/api/global-api.html#watch" class="sidebar-link">watch</a></li><li class="sidebar-sub-header"><a href="/api/global-api.html#use" class="sidebar-link">use</a></li><li class="sidebar-sub-header"><a href="/api/global-api.html#set" class="sidebar-link">set</a></li><li class="sidebar-sub-header"><a href="/api/global-api.html#delete" class="sidebar-link">delete</a></li><li class="sidebar-sub-header"><a href="/api/global-api.html#getmixin" class="sidebar-link">getMixin</a></li><li class="sidebar-sub-header"><a href="/api/global-api.html#implement" class="sidebar-link">implement</a></li><li class="sidebar-sub-header"><a href="/api/global-api.html#config" class="sidebar-link">config</a></li></ul></li><li><a href="/api/instance-api.html" class="sidebar-link">实例api</a></li><li><a href="/api/directives.html" class="sidebar-link">模板指令</a></li><li><a href="/api/compile.html" class="sidebar-link">编译构建</a></li><li><a href="/api/builtIn.html" class="sidebar-link">内建组件</a></li><li><a href="/api/extend.html" class="sidebar-link">周边拓展</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="全局api"><a href="#全局api" class="header-anchor">#</a> 全局api</h1> <h2 id="createapp"><a href="#createapp" class="header-anchor">#</a> createApp</h2> <blockquote><p>注册一个小程序，接受一个 Object 类型的参数</p></blockquote> <ul><li><strong>用法：</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">createApp</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre></div><ul><li><p><strong>参数：</strong></p> <ul><li><p><code>{Object} options</code></p> <p>可指定小程序的生命周期回调，以及一些全局变量等</p></li></ul></li> <li><p><strong>示例：</strong></p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> mpx<span class="token punctuation">,</span> <span class="token punctuation">{</span>createApp<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>

mpx<span class="token punctuation">.</span><span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">onLaunch</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Launch'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onShow</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Page show'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//全局变量 可通过getApp()访问</span>
  <span class="token literal-property property">globalDataA</span><span class="token operator">:</span> <span class="token string">'I am global dataA'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">globalDataB</span><span class="token operator">:</span> <span class="token string">'I am global dataB'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">createApp</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre></div><h2 id="createpage"><a href="#createpage" class="header-anchor">#</a> createPage</h2> <blockquote><p>类微信小程序（微信、百度、头条等）内部使用<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/component.html" target="_blank" rel="noopener noreferrer">Component的方式创建页面<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，所以除了支持页面的生命周期之外还同时支持组件的一切特性。当使用 Component 创建页面时，页面生命周期需要写在 methods 内部（微信小程序原生规则），mpx 进行了统一封装转换，页面生命周期都写在最外层即可</p></blockquote> <ul><li><p><strong>用法：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">createPage</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>参数：</strong></p> <ul><li><p><code>{Object} options</code></p> <p>具体形式除了 computed、watch 这类 Mpx 扩展特性之外，其他的属性都参照原生小程序的官方文档即可。</p></li> <li><p><code>{Object} config</code>（可选参数）</p> <p>如果希望标识一个组件是最纯粹的原生组件，不用数据响应等能力，可通过 config.isNative 传 true 声明。
如果有需要复写/改写最终调用的创建页面的构造器，可以通过 config 对象的 customCtor 提供。
<strong>注意:</strong>
mpx本身是用 component 来创建页面的，如果传page可能在初始化时候生命周期不正常导致取props有一点问题</p></li></ul></li> <li><p><strong>示例：</strong></p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> mpx<span class="token punctuation">,</span> <span class="token punctuation">{</span>createPage<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>

mpx<span class="token punctuation">.</span><span class="token function">createPage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">test2</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>test <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">test</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span> old</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> old<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onShow</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>test<span class="token operator">++</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">createPage</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span>
</code></pre></div><h2 id="createcomponent"><a href="#createcomponent" class="header-anchor">#</a> createComponent</h2> <blockquote><p>创建自定义组件，接受两个Object类型的参数。</p></blockquote> <ul><li><p><strong>用法：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">createComponent</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>参数：</strong></p> <ul><li><p><code>{Object} options</code></p> <p>具体形式除了 computed、watch 这类 Mpx 扩展特性之外，其他的属性都参照原生小程序的官方文档即可。</p></li> <li><p><code>{Object} config</code>（可选参数）</p> <p>如果希望标识一个组件是最纯粹的原生组件，不用数据响应等能力，可通过 config.isNative 传 true 声明。
如果有需要复写/改写最终调用的创建组件的构造器，可以通过 config 对象的 customCtor 提供。</p></li></ul></li> <li><p><strong>示例：</strong></p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> mpx<span class="token punctuation">,</span> <span class="token punctuation">{</span>createComponent<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>

mpx<span class="token punctuation">.</span><span class="token function">createComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">prop</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">10</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">test2</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>test <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>prop
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">test</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span> old</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> old<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">prop</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">handler</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span> old</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> old<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 是否首次执行一次</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">createComponent</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span>
</code></pre></div><h2 id="createstore"><a href="#createstore" class="header-anchor">#</a> createStore</h2> <blockquote><p>创建一个全局状态管理容器，实现复杂场景下的组件通信需求</p></blockquote> <ul><li><p><strong>用法：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>options <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>参数：</strong></p> <ul><li><p><code>{Object} options</code></p> <p>options 可指定以下属性：</p> <ul><li><p><strong>state</strong></p> <p>类型：<code>Object</code></p> <p>store的根 state 对象。</p> <p><a href="/guide/advance/store.html#state">详细介绍</a></p></li> <li><p><strong>mutations</strong></p> <p>类型：<code>{ [type: string]: Function }</code></p> <p>在 store 上注册 mutation，处理函数总是接受 state 作为第一个参数（如果定义在模块中，则为模块的局部状态），payload 作为第二个参数（可选）。</p> <p><a href="/guide/advance/store.html#mutation">详细介绍</a></p></li> <li><p><strong>actions</strong></p> <p>类型：<code>{ [type: string]: Function }</code></p> <p>在 store 上注册 action。处理函数总是接受 context 作为第一个参数，payload 作为第二个参数（可选）。</p> <p>context 对象包含以下属性：</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token punctuation">{</span>
   state<span class="token punctuation">,</span>      <span class="token comment">// 等同于 `store.state`</span>
   commit<span class="token punctuation">,</span>     <span class="token comment">// 等同于 `store.commit`</span>
   dispatch<span class="token punctuation">,</span>   <span class="token comment">// 等同于 `store.dispatch`</span>
   getters     <span class="token comment">// 等同于 `store.getters`</span>
 <span class="token punctuation">}</span>
</code></pre></div><p>同时如果有第二个参数 payload 的话也能够接收。</p> <p><a href="/guide/advance/store.html#action">详细介绍</a></p></li> <li><p><strong>getters</strong></p> <p>类型：<code>{[key: string]: Function }</code></p> <p>在 store 上注册 getter，getter 方法接受以下参数：</p> <div class="language-js extra-class"><pre class="language-js"><code>state<span class="token punctuation">,</span>     <span class="token comment">// 如果在模块中定义则为模块的局部状态</span>
getters   <span class="token comment">// 等同于 store.getters</span>
</code></pre></div><p>注册的 getter 暴露为 store.getters。</p> <p><a href="/guide/advance/store.html#getter">详细介绍</a></p></li> <li><p><strong>modules</strong></p> <p>类型：<code>Object</code></p> <p>包含了子模块的对象，会被合并到 store，大概长这样：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">,</span>
    mutations<span class="token punctuation">,</span>
    actions<span class="token operator">?</span><span class="token punctuation">,</span>
    getters<span class="token operator">?</span><span class="token punctuation">,</span>
    modules<span class="token operator">?</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>与根模块的选项一样，每个模块也包含 state 和 mutations 选项。模块的状态使用 key 关联到 store 的根状态。模块的 mutation 和 getter 只会接收 module 的局部状态作为第一个参数，而不是根状态，并且模块 action 的 context.state 同样指向局部状态。</p> <p><a href="/guide/advance/store.html#modules">详细介绍</a></p></li> <li><p><strong>deps</strong></p> <p>类型：<code>Object</code></p> <p>包含了当前store依赖的第三方store：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">store1</span><span class="token operator">:</span> storeA<span class="token punctuation">,</span>
  <span class="token literal-property property">store2</span><span class="token operator">:</span> storeB
<span class="token punctuation">}</span>
</code></pre></div><p><a href="/guide/advance/store.html#modules">详细介绍</a></p></li></ul></li></ul></li> <li><p><strong>示例：</strong></p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> mpx<span class="token punctuation">,</span> <span class="token punctuation">{</span>createStore<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>
<span class="token keyword">const</span> store1 <span class="token operator">=</span> mpx<span class="token punctuation">.</span><span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mutations</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">increment</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>count<span class="token operator">++</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">increment</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> store2 <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>options <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p><strong>Store 实例属性</strong></p> <ul><li><p><strong>state</strong></p> <ul><li><p>类型：<code>Object</code></p> <p>根状态。</p></li></ul></li> <li><p><strong>getters</strong></p> <ul><li><p>类型：<code>Object</code></p> <p>暴露出注册的 getter。</p></li></ul></li></ul></li> <li><p><strong>Store 实例方法</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">commit</span><span class="token punctuation">(</span>type<span class="token operator">:</span> string<span class="token punctuation">,</span> payload<span class="token operator">?</span><span class="token operator">:</span> any<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> Object<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">commit</span><span class="token punctuation">(</span>mutation<span class="token operator">:</span> Object<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> Object<span class="token punctuation">)</span>
</code></pre></div><p>提交 mutation。<a href="/guide/advance/store.html#mutation">详细介绍</a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">dispatch</span><span class="token punctuation">(</span>type<span class="token operator">:</span> string<span class="token punctuation">,</span> payload<span class="token operator">?</span><span class="token operator">:</span> any<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> Object<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token operator">:</span> Object<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> Object<span class="token punctuation">)</span>
</code></pre></div><p>分发 action。返回一个Promise。<a href="/guide/advance/store.html#action">详细介绍</a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">mapState</span><span class="token punctuation">(</span>map<span class="token operator">:</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token operator">|</span> Object<span class="token punctuation">)</span><span class="token operator">:</span> Object
</code></pre></div><p>为组件创建计算属性以返回 store 中的状态。<a href="/guide/advance/store.html#state">详细介绍</a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">mapGetters</span><span class="token punctuation">(</span>map<span class="token operator">:</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token operator">|</span> Object<span class="token punctuation">)</span><span class="token operator">:</span> Object
</code></pre></div><p>为组件创建计算属性以返回 getter 的返回值。<a href="/guide/advance/store.html#getter">详细介绍</a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">mapActions</span><span class="token punctuation">(</span>map<span class="token operator">:</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token operator">|</span> Object<span class="token punctuation">)</span><span class="token operator">:</span> Object
</code></pre></div><p>创建组件方法分发 action。<a href="/guide/advance/store.html#action">详细介绍</a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">mapMutations</span><span class="token punctuation">(</span>map<span class="token operator">:</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token operator">|</span> Object<span class="token punctuation">)</span><span class="token operator">:</span> Object
</code></pre></div><p>创建组件方法提交 mutation。<a href="/guide/advance/store.html#mutation">详细介绍</a></p></li></ul> <h2 id="createstorewiththis"><a href="#createstorewiththis" class="header-anchor">#</a> createStoreWithThis</h2> <blockquote><p>createStoreWithThis 为 createStore 的变种方法，主要为了在 <code>Typescript</code> 环境中，可以更好地支持 store 中的类型推导。<br>
其主要变化在于定义 getters， mutations 和 actions 时，
自身的 state，getters 等属性不再通过参数传入，而是会挂载到函数的执行上下文 this 当中，通过 this.state 或 this.getters 的方式进行访问。
由于TS的能力限制，getters/mutations/actions 只有使用对象字面量的方式直接传入 createStoreWithThis 时
才能正确推导出 this 的类型，当需要将 getters/mutations/actions 拆解为对象编写时，需要用户显式地声明 this 类型，无法直接推导得出。</p></blockquote> <ul><li><strong>用法：</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">createStoreWithThis</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>
</code></pre></div><ul><li><p><strong>参数：</strong></p> <ul><li><p><code>{Object} store</code></p> <p>接收一个 store 对象。</p></li></ul></li> <li><p><strong>示例：</strong></p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">import</span> <span class="token punctuation">{</span>createComponent<span class="token punctuation">,</span> getMixin<span class="token punctuation">,</span> createStoreWithThis<span class="token punctuation">}</span> <span class="token keyword">from</span> '@mpxjs<span class="token operator">/</span>core

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStoreWithThis</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">aa</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">bb</span><span class="token operator">:</span> <span class="token number">2</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">getters</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">cc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>aa <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>bb
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">doSth3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>getters<span class="token punctuation">.</span>cc<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">createComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">'2'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>b
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">d</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// data, mixin, computed中定义的数据能够被推导到this中</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>aaa <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>c
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 从store上map过来的计算属性或者方法同样能够被推导到this中</span>
    <span class="token operator">...</span>store<span class="token punctuation">.</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'aa'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mixins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 使用mixins，需要对每一个mixin子项进行getMixin辅助函数包裹，支持嵌套mixin</span>
    <span class="token function">getMixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">aaa</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token number">123</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">doSth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>aaa<span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">doSth2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token operator">++</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>d<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>aa<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doSth3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>store<span class="token punctuation">.</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'doSth3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="createstatewiththis"><a href="#createstatewiththis" class="header-anchor">#</a> createStateWithThis</h2> <blockquote><p>createStateWithThis 为创建 state 提供了类型推导，对于基本类型可以由 TypeScript 自行推导，使用其他类型时，推荐使用 as 进行约束</p></blockquote> <ul><li><p><strong>用法：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">createStateWithThis</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>参数：</strong></p> <ul><li><p><code>{Object} state</code></p> <p>需要定义的 state 对象键值对。</p></li></ul></li> <li><p><strong>示例：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStateWithThis <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>

<span class="token keyword">export</span> type StatusType <span class="token operator">=</span> <span class="token string">'start'</span> <span class="token operator">|</span> <span class="token string">'running'</span> <span class="token operator">|</span> <span class="token string">'stop'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStateWithThis</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">'running'</span> <span class="token keyword">as</span> StatusType
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="creategetterswiththis"><a href="#creategetterswiththis" class="header-anchor">#</a> createGettersWithThis</h2> <ul><li><p><strong>用法：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">createGettersWithThis</span><span class="token punctuation">(</span>getters<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>参数：</strong></p> <ul><li><p><code>{Object} getters</code></p> <p>需要定义的 getters 对象。</p></li> <li><p><code>{Object} options</code>（可选参数）</p> <p>在 options 中可以传入 state，getters，deps。由于 getter 的类型推论需要基于 state，所以导出 getters 时，需要将 state 进行传入。deps 是作为一个扩展存在，getters 可以通过 deps 中传入的其他 store 来获取值，当 store 没有其他需要依赖的 deps 时可以不传。createMutationsWithThis 和 createActionsWithThis 同理。</p></li></ul></li> <li><p><strong>示例：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createGettersWithThis<span class="token punctuation">,</span> createStoreWithThis <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createGettersWithThis</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">isStart</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'start'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">getNum</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>base<span class="token punctuation">.</span>test <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>getters<span class="token punctuation">.</span>base<span class="token punctuation">.</span>getTest
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">,</span>
  <span class="token literal-property property">deps</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">base</span><span class="token operator">:</span> <span class="token function">createStoreWithThis</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">testNum</span><span class="token operator">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">getters</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">getTest</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>testNum <span class="token operator">*</span> <span class="token number">2</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="createmutationswiththis"><a href="#createmutationswiththis" class="header-anchor">#</a> createMutationsWithThis</h2> <ul><li><p><strong>用法：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">createMutationsWithThis</span><span class="token punctuation">(</span>mutations<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>参数：</strong></p> <ul><li><p><code>{Object} mutations</code></p> <p>需要定义的 mutations 对象。</p></li> <li><p><code>{Object} options</code>（可选参数）</p> <p>在 options 中可以传入 state，deps。</p></li></ul></li> <li><p><strong>示例：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createMutationsWithThis <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createMutationsWithThis</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setCurrentStatus</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">payload</span><span class="token operator">:</span> StatusType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>status <span class="token operator">=</span> payload
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> state <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="createactionswiththis"><a href="#createactionswiththis" class="header-anchor">#</a> createActionsWithThis</h2> <ul><li><p><strong>用法：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">createActionsWithThis</span><span class="token punctuation">(</span>actions<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>参数：</strong></p> <ul><li><p><code>{Object} actions</code></p> <p>需要定义的 actions 对象。</p></li> <li><p><code>{Object} options</code>（可选参数）</p> <p>由于action 可以同时调用 getters、mutations，所以需要将这些都传入，以便进行类型推导。因此 options 可以传入 state、getters、mutations、deps。</p></li></ul></li> <li><p><strong>示例：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createActionsWithThis <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>
<span class="token keyword">import</span> state<span class="token punctuation">,</span> <span class="token punctuation">{</span> StatusType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./state'</span>
<span class="token keyword">import</span> getters <span class="token keyword">from</span> <span class="token string">'./getters'</span>
<span class="token keyword">import</span> mutations <span class="token keyword">from</span> <span class="token string">'./mutations'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createActionsWithThis</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">testActions</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">payload</span><span class="token operator">:</span> StatusType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'setCurrentStatus'</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">,</span>
  getters<span class="token punctuation">,</span>
  mutations
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="mixin"><a href="#mixin" class="header-anchor">#</a> mixin</h2> <p>全局注入mixin方法接收两个参数：mpx.mixin(mixins, options)</p> <ul><li>第一个参数是要混入的mixins，接收类型 <code>MixinObject|MixinObject[]</code></li> <li>第二个参数是为全局混入配置，形如<code>{types:string|string[], stage:number}</code>，其中<code>types</code>用于控制mixin注入的范围，可选值有<code>'app'|'page'|'component'</code>；<code>stage</code>用于控制注入mixin的插入顺序，当stage为负数时，注入的mixin会被插入到构造函数配置中的<code>options.mixins</code>之前，数值越小约靠前，反之当stage为正数时，注入的mixin会被插入到<code>options.mixins</code>之后，数值越大越靠后。</li></ul> <blockquote><p>所有mixin中生命周期的执行均先于构造函数配置中直接声明的生命周期，mixin之间的执行顺序则遵从于其在<code>options.mixins</code>数组中的顺序</p></blockquote> <blockquote><p>options的默认值为<code>{types: ['app','page','component'], stage: -1}</code>，不传stage时，全局注入mixin的声明周期默认在<code>options.mixins</code>之前执行</p></blockquote> <p><strong>使用</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> mpx <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>
<span class="token comment">// 只在page中混入</span>
mpx<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">getData</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">types</span><span class="token operator">:</span><span class="token string">'page'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 默认混入，在app|page|component中都会混入</span>
mpx<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">getData</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">setData</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 只在component中混入，且执行顺序在options.mixins之后</span>
mpx<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">attached</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'com attached'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">types</span><span class="token operator">:</span> <span class="token string">'component'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">stage</span><span class="token operator">:</span> <span class="token number">100</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="injectmixins"><a href="#injectmixins" class="header-anchor">#</a> injectMixins</h2> <p>该方法是 <code>mpx.mixin</code> 方法的别名，<code>mpx.injectMixins({})</code> 等同于 <code>mpx.mixin({})</code></p> <h2 id="topureobject"><a href="#topureobject" class="header-anchor">#</a> toPureObject</h2> <ul><li><p><strong>参数</strong>：</p> <ul><li><code>{Object} options</code></li></ul></li> <li><p><strong>用法</strong>:</p></li></ul> <p>由于使用的 mobx 的响应式数据，所以业务拿到的数据可能是 mobx 响应式数据实例（包含了些其他属性），使用<code>toPureObject</code>方法可以将响应式的数据转化成纯 js 对象。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> mpx<span class="token punctuation">,</span> <span class="token punctuation">{</span>toPureObject<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>
<span class="token comment">// mpx.toPureObject(...)</span>
<span class="token keyword">const</span> pureObject <span class="token operator">=</span> <span class="token function">toPureObject</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span>
</code></pre></div><h2 id="observable"><a href="#observable" class="header-anchor">#</a> observable</h2> <ul><li><p><strong>参数</strong>：</p> <ul><li><code>{Object} options</code></li></ul></li> <li><p><strong>用法</strong>:</p></li></ul> <p>用于创建响应式数据，属于 mobx 提供的能力。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> mpx<span class="token punctuation">,</span> <span class="token punctuation">{</span>observable<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>
<span class="token comment">// mpx.observable(...)</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span>
</code></pre></div><h2 id="watch"><a href="#watch" class="header-anchor">#</a> watch</h2> <ul><li><p><strong>参数</strong>：</p> <ul><li><code>{Function} expr</code></li> <li><code>{Function | Object} callback</code></li> <li><code>{Object} [options]</code> <ul><li><code>{boolean} deep</code></li> <li><code>{boolean | Function} once</code></li> <li><code>{boolean} immediate</code></li></ul></li></ul></li> <li><p><strong>返回值</strong>：<code>{Function} unwatch</code></p></li> <li><p><strong>用法</strong>:</p> <p>观察一个函数计算结果的变化。回调函数得到的参数分别为新值和旧值。参数详细说明：</p> <ol><li><code>expr</code>：是函数类型，返回一个你需要观察的表达式，表达式的运算量需要是响应式数据。</li> <li><code>callback</code>：响应函数，如果是对象，则 callback.handler 为回调函数，其他参数作为 options。</li></ol> <p>返回值详细说明：</p> <p><code>unwatch</code>：返回一个函数，用来取消观察，停止触发回调。</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>watch<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>

<span class="token keyword">let</span> unwatch <span class="token operator">=</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>b
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 做点什么</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 调用返回值unwatch可以取消观察</span>
<span class="token function">unwatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p><strong>选项</strong>：deep</p> <p>为了发现对象内部值的变化，可以在选项参数中指定 deep: true。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>watch<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>

<span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>someObject
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 回调函数</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>someObject<span class="token punctuation">.</span>nestedValue <span class="token operator">=</span> <span class="token number">123</span>
<span class="token comment">// callback is fired</span>
</code></pre></div></li> <li><p><strong>选项</strong>：once</p> <p>在选项参数中指定 <code>once: true</code> 该回调方法只会执行一次，后续的改变将不会触发回调；<br>
该参数也可以是函数，若函数返回值为 <code>true</code> 时，则后续的改变将不会触发回调</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>watch<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>

<span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 该回调函数只会执行一次</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">once</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 当 once 是函数时</span>
<span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a
 <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span> newVal</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 当 val 等于2时，this.a 的后续改变将不会被监听</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">once</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>选项</strong>：immediate</p> <p>在选项参数中指定 <code>immediate: true</code> 将立即以表达式的当前值触发回调。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>watch<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>

<span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 回调函数</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 立即以 `this.a` 的当前值触发回调</span>
</code></pre></div><p>注意在带有 immediate 选项时，你不能在第一次回调时取消侦听。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>watch<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>

<span class="token keyword">var</span> unwatch <span class="token operator">=</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">unwatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 这会导致报错！</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>如果你仍然希望在回调内部调用取消侦听的函数，你应该先检查其可用性。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>watch<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>

<span class="token keyword">var</span> unwatch <span class="token operator">=</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>unwatch<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 请先检查其可用性！</span>
    <span class="token function">unwatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div></li> <li><p><strong>参考</strong>：另外 Mpx 还提供了实例方法 $watch，详见：<a href="/api/instance-api.html#watch">$watch</a></p></li></ul> <h2 id="use"><a href="#use" class="header-anchor">#</a> use</h2> <blockquote><p>用于安装外部扩展, 支持多参数
方法接收两个参数：mpx.use(plugin, options)</p></blockquote> <ul><li>第一个参数是要安装的外部扩展</li> <li>第二个参数是对象，如果第二个参数是一个包含（prefix or postfix）的option， 那么将会对插件扩展的属性添加前缀或后缀</li></ul> <p><strong>示例：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> mpx <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>
<span class="token keyword">import</span> test <span class="token keyword">from</span> <span class="token string">'./test'</span>
mpx<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span>
mpx<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>test<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">prefix</span><span class="token operator">:</span> <span class="token string">'mpx'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'otherparams'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="set"><a href="#set" class="header-anchor">#</a> set</h2> <p>用于对一个响应式对象新增属性，会<code>触发订阅者更新操作</code></p> <ul><li><p><strong>参数</strong>：</p> <ul><li><code>{Object | Array} target</code></li> <li><code>{string | number} propertyName/index</code></li> <li><code>{any} value</code></li></ul></li> <li><p><strong>示例：</strong></p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>mport mpx<span class="token punctuation">,</span> <span class="token punctuation">{</span>observable<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>
<span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
mpx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span> <span class="token comment">// age 改变后会触发订阅者视图更新</span>
</code></pre></div><h2 id="delete"><a href="#delete" class="header-anchor">#</a> delete</h2> <p>用于对一个响应式对象删除属性，会<code>触发订阅者更新操作</code></p> <ul><li><strong>参数</strong>：
<ul><li><code>{Object | Array} target</code></li> <li><code>{string | number} propertyName/index</code></li></ul></li> <li><strong>示例：</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>mport mpx<span class="token punctuation">,</span> <span class="token punctuation">{</span>observable<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>
<span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
mpx<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="getmixin"><a href="#getmixin" class="header-anchor">#</a> getMixin</h2> <p>专为ts项目提供的反向推导辅助方法，该函数接收类型为 <code>Object</code> ,会将传入的嵌套mixins对象拉平成一个扁平的mixin对象</p> <p><strong>使用</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> mpx<span class="token punctuation">,</span> <span class="token punctuation">{</span> createComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>
<span class="token comment">// 使用mixins，需要对每一个mixin子项进行getMixin辅助函数包裹，支持嵌套mixin</span>
<span class="token keyword">const</span> mixin <span class="token operator">=</span> mpx<span class="token punctuation">.</span><span class="token function">getMixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">mixins</span><span class="token operator">:</span> <span class="token punctuation">[</span>mpx<span class="token punctuation">.</span><span class="token function">getMixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value1</span><span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">lifetimes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">attached</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value1<span class="token punctuation">,</span> <span class="token string">'attached'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">mixins</span><span class="token operator">:</span> <span class="token punctuation">[</span>mpx<span class="token punctuation">.</span><span class="token function">getMixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value2</span><span class="token operator">:</span> <span class="token number">6</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value1 <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value2 <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>outsideVal<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/*
mixin值
{
  data: {value2: 6, value1: 2},
  created: ƒ created(),
  attached: ƒ attached()
}
*/</span>
<span class="token function">createComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">outsideVal</span><span class="token operator">:</span> <span class="token number">20</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mixins</span><span class="token operator">:</span> <span class="token punctuation">[</span>mixin<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/*
以上执行输出：
28
2 &quot;attached&quot;
*/</span>
</code></pre></div><h2 id="implement"><a href="#implement" class="header-anchor">#</a> implement</h2> <ul><li><p><strong>参数</strong>：</p> <ul><li><code>{String} name</code></li> <li><code>{Object} options</code> <ul><li><code>{Array} modes</code>：需要取消的平台</li> <li><code>{Boolean} remove</code>：是否将此能力直接移除</li> <li><code>{Function} processor</code>：设置成功的回调函数</li></ul></li></ul></li> <li><p><strong>用法</strong>:</p></li></ul> <p>以微信为 base 将代码转换输出到其他平台时（如支付宝、web 平台等），会存在一些无法进行模拟的跨平台差异，会在运行时进行检测并报错指出，例如微信转支付宝时使用 moved 生命周期等。使用<code>implement</code>方法可以取消这种报错。您可以使用 mixin 自行实现跨平台差异，然后使用 implement 取消报错。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> mpx <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>__mpx_mode__ <span class="token operator">===</span> <span class="token string">'web'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">processor</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
  mpx<span class="token punctuation">.</span><span class="token function">implement</span><span class="token punctuation">(</span><span class="token string">'onShareAppMessage'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">modes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'web'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 需要取消的平台，可配置多个</span>
    <span class="token literal-property property">remove</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否将此能力直接移除</span>
    processor <span class="token comment">// 设置成功的回调函数</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="config"><a href="#config" class="header-anchor">#</a> config</h2> <p>Mpx 通过 config 暴露出 webRouteConfig 配置项，在 web 环境可以对路由进行配置</p> <ul><li><strong>用法</strong>:</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>mpx<span class="token punctuation">.</span>config<span class="token punctuation">.</span>webRouteConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'history'</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/api/config.html" class="prev">
        全局配置
      </a></span> <span class="next"><a href="/api/instance-api.html">
        实例api
      </a>
      →
    </span></p></div> </main></div></div></div></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.b3e4347f.js" defer></script><script src="/assets/js/6.831707e4.js" defer></script><script src="/assets/js/1.8362f1c2.js" defer></script><script src="/assets/js/22.d6b28d2e.js" defer></script><script src="/assets/js/7.d18ec5bf.js" defer></script>
  </body>
</html>
