<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>编译构建 | Mpx框架</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="深度性能优化的增强型小程序开发框架">
    
    <link rel="preload" href="/assets/css/0.styles.9913be21.css" as="style"><link rel="preload" href="/assets/js/app.b3e4347f.js" as="script"><link rel="preload" href="/assets/js/6.831707e4.js" as="script"><link rel="preload" href="/assets/js/1.8362f1c2.js" as="script"><link rel="preload" href="/assets/js/18.b378d290.js" as="script"><link rel="preload" href="/assets/js/7.d18ec5bf.js" as="script"><link rel="prefetch" href="/assets/js/10.fd0f5395.js"><link rel="prefetch" href="/assets/js/11.0d2e4af7.js"><link rel="prefetch" href="/assets/js/12.2c6c36bb.js"><link rel="prefetch" href="/assets/js/13.edbfa566.js"><link rel="prefetch" href="/assets/js/14.83ba8d76.js"><link rel="prefetch" href="/assets/js/15.6cf1dc24.js"><link rel="prefetch" href="/assets/js/16.417155c7.js"><link rel="prefetch" href="/assets/js/17.cc6e5111.js"><link rel="prefetch" href="/assets/js/19.5c436eb1.js"><link rel="prefetch" href="/assets/js/2.e2289ad6.js"><link rel="prefetch" href="/assets/js/20.38a71dd8.js"><link rel="prefetch" href="/assets/js/21.7b33ed8c.js"><link rel="prefetch" href="/assets/js/22.d6b28d2e.js"><link rel="prefetch" href="/assets/js/23.1bb3d80b.js"><link rel="prefetch" href="/assets/js/24.1c6500e1.js"><link rel="prefetch" href="/assets/js/25.65058d3a.js"><link rel="prefetch" href="/assets/js/26.dd48289b.js"><link rel="prefetch" href="/assets/js/27.cd0763e3.js"><link rel="prefetch" href="/assets/js/28.677927d7.js"><link rel="prefetch" href="/assets/js/29.08cc9ede.js"><link rel="prefetch" href="/assets/js/30.61d2042c.js"><link rel="prefetch" href="/assets/js/31.361d3fef.js"><link rel="prefetch" href="/assets/js/32.30663c92.js"><link rel="prefetch" href="/assets/js/33.f30fdf06.js"><link rel="prefetch" href="/assets/js/34.45c1d2d3.js"><link rel="prefetch" href="/assets/js/35.607390b6.js"><link rel="prefetch" href="/assets/js/36.60cd9a9e.js"><link rel="prefetch" href="/assets/js/37.4f688e60.js"><link rel="prefetch" href="/assets/js/38.b47a446a.js"><link rel="prefetch" href="/assets/js/39.499aa852.js"><link rel="prefetch" href="/assets/js/4.1f2e8e96.js"><link rel="prefetch" href="/assets/js/40.bfacec42.js"><link rel="prefetch" href="/assets/js/41.140b5336.js"><link rel="prefetch" href="/assets/js/42.5bd54330.js"><link rel="prefetch" href="/assets/js/43.9d595a42.js"><link rel="prefetch" href="/assets/js/44.72af5911.js"><link rel="prefetch" href="/assets/js/45.2f2a87c3.js"><link rel="prefetch" href="/assets/js/46.2e5fdde3.js"><link rel="prefetch" href="/assets/js/47.f95e0062.js"><link rel="prefetch" href="/assets/js/48.e5029069.js"><link rel="prefetch" href="/assets/js/49.5de82fff.js"><link rel="prefetch" href="/assets/js/5.b5910773.js"><link rel="prefetch" href="/assets/js/50.0e800e46.js"><link rel="prefetch" href="/assets/js/51.9c9d4fae.js"><link rel="prefetch" href="/assets/js/52.03c99e23.js"><link rel="prefetch" href="/assets/js/53.f8ba4f1d.js"><link rel="prefetch" href="/assets/js/54.be8be90f.js"><link rel="prefetch" href="/assets/js/55.a697da32.js"><link rel="prefetch" href="/assets/js/56.ec7de33d.js"><link rel="prefetch" href="/assets/js/57.5ab60986.js"><link rel="prefetch" href="/assets/js/58.6d73f23b.js"><link rel="prefetch" href="/assets/js/59.c960b24a.js"><link rel="prefetch" href="/assets/js/60.aa0ee4b1.js"><link rel="prefetch" href="/assets/js/61.3fbe8717.js"><link rel="prefetch" href="/assets/js/62.fe55872e.js"><link rel="prefetch" href="/assets/js/63.94c76cd3.js"><link rel="prefetch" href="/assets/js/64.fbf9bb6c.js"><link rel="prefetch" href="/assets/js/65.e7240ed7.js"><link rel="prefetch" href="/assets/js/66.539127de.js"><link rel="prefetch" href="/assets/js/67.060c4e85.js"><link rel="prefetch" href="/assets/js/68.e4ee3984.js"><link rel="prefetch" href="/assets/js/69.06a4432a.js"><link rel="prefetch" href="/assets/js/8.465b2516.js"><link rel="prefetch" href="/assets/js/9.83220d36.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9913be21.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><div class="content-wrapper"><div class="container"><div class="theme-container"><header class="header" data-v-8e5e0702><!----> <div class="head-container" data-v-8e5e0702><a href="/" data-v-8e5e0702><div class="logo" data-v-8e5e0702>mpx</div></a> <div class="row" data-v-8e5e0702><div class="header__line" data-v-8e5e0702></div> <nav class="nav" data-v-8e5e0702><a href="/guide/basic/start.html" class="nav-link" data-v-8e5e0702>
          指南
          <!----></a></nav><nav class="nav" data-v-8e5e0702><a href="/api/config.html" class="nav-link" data-v-8e5e0702>
          API
          <!----></a></nav><nav class="nav" data-v-8e5e0702><a href="/articles/" class="nav-link" data-v-8e5e0702>
          文章
          <!----></a></nav><nav class="nav" data-v-8e5e0702><a href="https://github.com/didi/mpx/releases" class="nav-link" data-v-8e5e0702>
          更新记录
          <!----></a></nav><nav class="nav" data-v-8e5e0702><a href="https://github.com/didi/mpx" class="nav-link" data-v-8e5e0702>
          GitHub
          <!----></a></nav> <div class="searchBox-wrapper" data-v-8e5e0702><div class="searchBox" data-v-8e5e0702><form id="search-form" role="search" class="algolia-search-wrapper search-box" data-v-8e5e0702><div id="docsearch-container"></div></form></div></div></div></div> <!----></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/basic/start.html" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/api/config.html" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/articles/index.html" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="https://github.com/didi/mpx/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  更新记录
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/didi/mpx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/api/config.html" class="sidebar-link">全局配置</a></li><li><a href="/api/global-api.html" class="sidebar-link">全局api</a></li><li><a href="/api/instance-api.html" class="sidebar-link">实例api</a></li><li><a href="/api/directives.html" class="sidebar-link">模板指令</a></li><li><a href="/api/compile.html" aria-current="page" class="active sidebar-link">编译构建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/compile.html#webpack配置" class="sidebar-link">webpack配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/compile.html#output-publicpath" class="sidebar-link">output.publicPath</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#output-filename" class="sidebar-link">output.filename</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#node-global" class="sidebar-link">node.global</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#rule-resourcequery" class="sidebar-link">rule.resourceQuery</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#resolve-extensions" class="sidebar-link">resolve.extensions</a></li></ul></li><li class="sidebar-sub-header"><a href="/api/compile.html#类型定义" class="sidebar-link">类型定义</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/compile.html#rules" class="sidebar-link">Rules</a></li></ul></li><li class="sidebar-sub-header"><a href="/api/compile.html#mpxwebpackplugin-options" class="sidebar-link">MpxWebpackPlugin options</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/compile.html#mode" class="sidebar-link">mode</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#srcmode" class="sidebar-link">srcMode</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#moderules" class="sidebar-link">modeRules</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#externalclasses" class="sidebar-link">externalClasses</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#resolvemode" class="sidebar-link">resolveMode</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#projectroot" class="sidebar-link">projectRoot</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#writemode" class="sidebar-link">writeMode</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#autoscoperules" class="sidebar-link">autoScopeRules</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#forcedisableproxyctor" class="sidebar-link">forceDisableProxyCtor</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#transmpxrules" class="sidebar-link">transMpxRules</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#autosplit" class="sidebar-link">autoSplit</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#defs" class="sidebar-link">defs</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#attributes" class="sidebar-link">attributes</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#externals" class="sidebar-link">externals</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#mininpmpackage" class="sidebar-link">miniNpmPackage</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#forceusepagector" class="sidebar-link">forceUsePageCtor</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#transrpxrules" class="sidebar-link">transRpxRules</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#postcssinlineconfig" class="sidebar-link">postcssInlineConfig</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#decodehtmltext" class="sidebar-link">decodeHTMLText</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#nativeconfig" class="sidebar-link">nativeConfig</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#webconfig" class="sidebar-link">webConfig</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#i18n" class="sidebar-link">i18n</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#auditresource" class="sidebar-link">auditResource</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#subpackagemodulesrules" class="sidebar-link">subpackageModulesRules</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#generatebuildmap" class="sidebar-link">generateBuildMap</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#autovirtualhostrules" class="sidebar-link">autoVirtualHostRules</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#partialcompile" class="sidebar-link">partialCompile</a></li></ul></li><li class="sidebar-sub-header"><a href="/api/compile.html#mpxwebpackplugin-static-methods" class="sidebar-link">MpxWebpackPlugin static methods</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/compile.html#mpxwebpackplugin-loader" class="sidebar-link">MpxWebpackPlugin.loader</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#mpxwebpackplugin-pluginloader" class="sidebar-link">MpxWebpackPlugin.pluginLoader</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#mpxwebpackplugin-wxspreloader" class="sidebar-link">MpxWebpackPlugin.wxsPreLoader</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#mpxwebpackplugin-fileloader" class="sidebar-link">MpxWebpackPlugin.fileLoader</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#mpxwebpackplugin-urlloader" class="sidebar-link">MpxWebpackPlugin.urlLoader</a></li></ul></li><li class="sidebar-sub-header"><a href="/api/compile.html#request-query" class="sidebar-link">Request query</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/compile.html#resolve" class="sidebar-link">?resolve</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#root" class="sidebar-link">?root</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#fallback" class="sidebar-link">?fallback</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#uselocal" class="sidebar-link">?useLocal</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#isstyle" class="sidebar-link">?isStyle</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#ispage" class="sidebar-link">?isPage</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#iscomponent" class="sidebar-link">?isComponent</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#async" class="sidebar-link">?async</a></li></ul></li></ul></li><li><a href="/api/builtIn.html" class="sidebar-link">内建组件</a></li><li><a href="/api/extend.html" class="sidebar-link">周边拓展</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="编译构建"><a href="#编译构建" class="header-anchor">#</a> 编译构建</h1> <h2 id="webpack配置"><a href="#webpack配置" class="header-anchor">#</a> webpack配置</h2> <p>下图是采用 Mpx 开发小程序时，一个简短的 webpack 配置。配置说明可参考图中注释以及子项说明。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">app</span><span class="token operator">:</span> <span class="token function">resolveSrc</span><span class="token punctuation">(</span><span class="token string">'app.mpx'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 和 webpack 配置一致,编译后文件输出的路径</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token function">resolveDist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'[name].js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">global</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.mpx$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token comment">// 以 .mpx 结尾的文件需要使用 Mpx 提供的 loader 进行解析，处理 .mpx 文件包含的template，script, style, json等各个部分</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> MpxWebpackPlugin<span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token comment">// 自定义 loaders</span>
          <span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">scss</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">{</span><span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span><span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'sass-loader'</span><span class="token punctuation">,</span> <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">sassOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">outputStyle</span><span class="token operator">:</span> <span class="token string">'nested'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token comment">// js 文件走正常的 babel 解析</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
        <span class="token comment">// include 和 exclude 定义哪些 .js 文件走 babel 编译，哪些不走 babel 编译，配置include、exclude 可以提高查找效率</span>
        <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'node_modules/@mpxjs'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'node_modules/**/src/third_party/'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// 适用于&lt;script type=&quot;application/json&quot; src=&quot;../common.json&quot;&gt;，Mpx内部会添加上__component，设置 type 以防止走 webpack 内建的 json 解析</span>
        <span class="token comment">// webpack json解析，抽取内容的占位内容必须为合法 json，否则会在 parse 阶段报错</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.json$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">resourceQuery</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">__component</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'javascript/auto'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// 各小程序平台自有脚本的差异抹平</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(wxs|qs|sjs|filter\.js)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> MpxWebpackPlugin<span class="token punctuation">.</span><span class="token function">wxsPreLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token string">'pre'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token comment">// Mpx 提供图像资源处理，支持 CDN 和 Base64 两种</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> MpxWebpackPlugin<span class="token punctuation">.</span><span class="token function">urlLoader</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'img/[name][hash].[ext]'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.mpx'</span><span class="token punctuation">,</span> <span class="token string">'.js'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'wx'</span><span class="token punctuation">,</span> <span class="token comment">// 可选值 wx/ali/swan/qq/tt/web</span>
      <span class="token literal-property property">srcMode</span><span class="token operator">:</span> <span class="token string">'ali'</span> <span class="token comment">// 暂时只支持微信为源mode做跨平台，为其他时mode必须和srcMode一致</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>下面是对 webpack 自带的配置，在 Mpx 中特殊配置的具体说明。</li></ul> <h3 id="output-publicpath"><a href="#output-publicpath" class="header-anchor">#</a> output.publicPath</h3> <p>由于 Mpx 内部框架实现的原因(如分包路径)，publicPath 必须设置为'/'，默认为'/'。
如是图像或文件需要设置 publicPath，可配置在 loader options 中。</p> <h3 id="output-filename"><a href="#output-filename" class="header-anchor">#</a> output.filename</h3> <p>小程序限定<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/structure.html" target="_blank" rel="noopener noreferrer">描述页面的文件具有相同的路径和文件名<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，仅以后缀名进行区分。</p> <p>因此 output.filename 中必须写为 [name].js，基于 chunk id 或者 hash name 的 filename 都会导致编译后的文件无法被小程序识别。</p> <h3 id="node-global"><a href="#node-global" class="header-anchor">#</a> node.global</h3> <p>在 Node 环境中 global 标识全局对象，Mpx 中需要依赖 global 进行运行时注入。</p> <h3 id="rule-resourcequery"><a href="#rule-resourcequery" class="header-anchor">#</a> rule.resourceQuery</h3> <p>Mpx 内部会对通过 script src 引入的 json 文件，在解析的时候加上 <code>__component</code> 标识，同时设置 <code>type</code> 为 <code>javascript/auto</code> 以防止走 webpack 内建的 json 解析。</p> <p>因为 webpack json 解析时，抽取内容的占位内容必须为合法 json，否则会在 parse 阶段报错</p> <h3 id="resolve-extensions"><a href="#resolve-extensions" class="header-anchor">#</a> resolve.extensions</h3> <p>当通过 require, import 引 入不带后缀的文件时，webpack 将自动带上后缀后去尝试访问文件是否存在。</p> <h2 id="类型定义"><a href="#类型定义" class="header-anchor">#</a> 类型定义</h2> <p>为了便于对编译配置的数据类型进行准确地描述，我们在这里对一些常用的配置类型进行定义</p> <h3 id="rules"><a href="#rules" class="header-anchor">#</a> Rules</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">Condition</span> <span class="token operator">=</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>resourcePath<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token operator">|</span> RegExp

<span class="token keyword">interface</span> <span class="token class-name">Rules</span> <span class="token punctuation">{</span>
  include<span class="token operator">?</span><span class="token operator">:</span> Condition <span class="token operator">|</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Condition<span class="token operator">&gt;</span>
  exclude<span class="token operator">?</span><span class="token operator">:</span> Condition <span class="token operator">|</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Condition<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="mpxwebpackplugin-options"><a href="#mpxwebpackplugin-options" class="header-anchor">#</a> MpxWebpackPlugin options</h2> <p>MpxWebpackPlugin支持传入以下配置：</p> <blockquote><p>若是通过官方脚手架生成的项目，可在 <code>build/mpx.plugin.conf.js</code> 中对这些项进行配置。</p></blockquote> <h3 id="mode"><a href="#mode" class="header-anchor">#</a> mode</h3> <ul><li><p><strong>类型</strong>：<code>string</code></p></li> <li><p><strong>默认值</strong>：<code>'wx'</code>。</p></li> <li><p><strong>详细</strong>：</p></li></ul> <p>mode 为 Mpx 编译的目标平台， 目前支持的有微信小程序(wx)\支付宝小程序(ali)\百度小程序(swan)\头条小程序(tt)\ QQ 小程序(qq)\ H5 页面(web)</p> <h3 id="srcmode"><a href="#srcmode" class="header-anchor">#</a> srcMode</h3> <ul><li><p><strong>类型</strong>：<code>'wx'</code></p></li> <li><p><strong>默认值</strong>：默认和 <a href="#mode">mode</a> 一致。</p></li> <li><p><strong>详细</strong>：当 srcMode 和 mode 不一致时，会读取相应的配置对项目进行编译和运行时的转换。</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 微信转支付宝</span>
<span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 指定目标平台，可选值有 wx、ali、swan、qq、tt、web</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'ali'</span><span class="token punctuation">,</span>
  <span class="token comment">// 指定源码平台，默认值同目标平台一致</span>
  <span class="token literal-property property">srcMode</span><span class="token operator">:</span> <span class="token string">'wx'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>暂时只支持微信为源 mode 做跨平台，为其他时，mode 必须和 srcMode 保持一致。</p></div> <h3 id="moderules"><a href="#moderules" class="header-anchor">#</a> modeRules</h3> <ul><li><p><strong>类型</strong>：<code>{ [key: string]: Rules }</code></p></li> <li><p><strong>详细</strong>：</p></li></ul> <p>批量指定文件mode，用于条件编译场景下使用某些单小程序平台的库时批量标记这些文件的mode为对应平台，而不再走转换规则。</p> <ul><li><strong>示例</strong>：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">modeRules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">ali</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'node_modules/vant-aliapp'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="externalclasses"><a href="#externalclasses" class="header-anchor">#</a> externalClasses</h3> <ul><li><p><strong>类型</strong>：<code>Array&lt;string&gt;</code></p></li> <li><p><strong>详细</strong>：定义若干个外部样式类，这些将会覆盖元素原有的样式。</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">externalClasses</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'custom-class'</span><span class="token punctuation">,</span> <span class="token string">'i-class'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>抹平支付宝和微信之间的差异，微信转支付宝时可以使用该功能。</p></div> <h3 id="resolvemode"><a href="#resolvemode" class="header-anchor">#</a> resolveMode</h3> <ul><li><p><strong>类型</strong>：<code>'webpack' | 'native'</code></p></li> <li><p><strong>默认值</strong>：<code>webpack</code></p></li> <li><p><strong>详细</strong>：</p></li></ul> <p>指定resolveMode，默认webpack，更便于引入npm包中的页面/组件等资源。若想编写时和原生保持一致或兼容已有原生项目，可设为native，此时需要提供<a href="#projectroot">projectRoot</a>以指定项目根目录，且使用npm资源时需在前面加<code>~</code>。</p> <ul><li><strong>示例</strong>：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">resolveMode</span><span class="token operator">:</span> <span class="token string">'webpack'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="projectroot"><a href="#projectroot" class="header-anchor">#</a> projectRoot</h3> <ul><li><p><strong>类型</strong>：<code>string</code></p></li> <li><p><strong>详细</strong>：当resolveMode为native时需通过该字段指定项目根目录。</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">resolveMode</span><span class="token operator">:</span> <span class="token string">'native'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">projectRoot</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="writemode"><a href="#writemode" class="header-anchor">#</a> writeMode</h3> <ul><li><p><strong>类型</strong>：<code>'full' | 'change'</code></p></li> <li><p><strong>默认值</strong>： <code>'change'</code></p></li> <li><p><strong>详细</strong>：webpack 的输出默认是全量输出，而小程序开发者工具不关心文件是否真正发生了变化。设置为 change 时，Mpx 在 watch 模式下将内部 diff 一次，只会对内容发生变化的文件进行写入，以提升小程序开发者工具编译性能。</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">writeMode</span><span class="token operator">:</span> <span class="token string">'change'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="autoscoperules"><a href="#autoscoperules" class="header-anchor">#</a> autoScopeRules</h3> <ul><li><p><strong>类型</strong>：<a href="#rules"><code>Rules</code></a></p></li> <li><p><strong>详细</strong>：是否需要对样式加 scope ，目前只有支付宝小程序平台没有样式隔离，因此该部分内容也只对支付宝小程序平台生效。提供 include 和 exclude 以精确控制对哪些文件进行样式隔离，哪些不隔离，和webpack的rules规则相同。也可以通过在 style 代码块上声明 scoped 进行。</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">autoScopeRules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'../src'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'../node_modules/vant-aliapp'</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// 比如一些组件库本来就是为支付宝小程序编写的，应该已经考虑过样式隔离，就不需要再添加</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="forcedisableproxyctor"><a href="#forcedisableproxyctor" class="header-anchor">#</a> forceDisableProxyCtor</h3> <ul><li><p><strong>类型</strong>：<code>Boolean</code></p></li> <li><p><strong>默认值</strong>： <code>false</code></p></li> <li><p><strong>详细</strong>： 用于控制在跨平台输出时对实例构造函数（<code>App</code> | <code>Page</code> | <code>Component</code> | <code>Behavior</code>）进行代理替换以抹平平台差异。当配置 <code>forceDisableProxyCtor</code> 为 true 时，会强行取消平台差异抹平逻辑，开发时需针对输出到不同平台进行条件判断。</p></li></ul> <h3 id="transmpxrules"><a href="#transmpxrules" class="header-anchor">#</a> transMpxRules</h3> <ul><li><p><strong>类型</strong>：<code>Rules</code></p></li> <li><p><strong>详细</strong>：是否转换 wx / my 等全局对象为 Mpx 对象，</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">transMpxRules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">include</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@mpxjs'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="autosplit"><a href="#autosplit" class="header-anchor">#</a> autoSplit</h3> <ul><li><p><strong>类型</strong>：<code>boolean</code></p></li> <li><p><strong>默认值</strong>：Web平台为 false, 其它平台为 true</p></li> <li><p><strong>详细</strong>：autoSplit 设置为 true 时，如果配置了 optimization，将采用 optimization 配置的 splitChunks 实现代码分离合并打包优化。设置为 false 将不走代码打包优化。</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack配置</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">runtimeChunk</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 将复用的模块抽取到一个外部的bundle中</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'bundle'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'bundle'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'initial'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'wx'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">srcMode</span><span class="token operator">:</span><span class="token string">'wx'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">autoSpit</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="defs"><a href="#defs" class="header-anchor">#</a> defs</h3> <ul><li><p><strong>类型</strong>：<code>{ [key: string]: string }</code></p></li> <li><p><strong>详细</strong>：给模板、js、json中定义一些全局常量。一般用于区分平台/环境。</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">defs</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">__env__</span><span class="token operator">:</span> <span class="token string">'mini'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>使用的时候：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> env <span class="token operator">=</span> __env__<span class="token punctuation">;</span>
</code></pre></div><blockquote><p>注意：这里定义之后使用的时候是按照全局变量来使用，而非按照<code>process.env.KEY</code>这样的形式</p></blockquote> <h3 id="attributes"><a href="#attributes" class="header-anchor">#</a> attributes</h3> <ul><li><p><strong>类型</strong>：<code>[key: string]</code></p></li> <li><p><strong>默认值</strong>：<code>['image:src', 'audio:src', 'video:src', 'cover-image:src', 'import:src', 'include:src']</code></p></li> <li><p><strong>详细</strong>：<code>Mpx</code> 提供了可以给自定义标签设置资源的功能，配置该属性后，即可在目标标签中使用 <code>:src</code> 加载相应资源文件</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'customTag:src'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>customTag</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>https://www....../avator.png'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>customTag</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>该属性可通过 <code>MpxWebpackPlugin</code> 配置，也可以通过配置 <code>WxmlLoader</code>，后者优先级高。</p></div> <h3 id="externals"><a href="#externals" class="header-anchor">#</a> externals</h3> <ul><li><p><strong>类型</strong>：<code>Array&lt;string&gt;</code></p></li> <li><p><strong>详细</strong>：</p> <p>目前仅支持微信小程序 weui 组件库通过 useExtendedLib 扩展库的方式引入，这种方式引入的组件将不会计入代码包大小。配置 externals 选项，Mpx 将不会解析 weui 组件的路径并打包。</p></li> <li><p><strong>示例</strong>：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Mpx 配置文件中添加如下配置：</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">externals</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'weui'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>json<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// app.mpx json部分</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;useExtendedLib&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;weui&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 在 page 中使用 weui 组件 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{__mpx_mode__ === 'wx'}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mp-icon</span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>play<span class="token punctuation">&quot;</span></span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>black<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{25}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>showDialog<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mp-icon</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mp-dialog</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span> <span class="token attr-name">show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{dialogShow}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bindbuttontap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tapDialogButton<span class="token punctuation">&quot;</span></span> <span class="token attr-name">buttons</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{buttons}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>test content<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mp-dialog</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span><span class="token punctuation">{</span> createPage <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>

  <span class="token function">createPage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">dialogShow</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">showOneButtonDialog</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">buttons</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'取消'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'确定'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">tapDialogButton</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dialogShow <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>showOneButtonDialog <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">showDialog</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dialogShow <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>json<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> wxComponents <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;mp-icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;weui-miniprogram/icon/icon&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;mp-dialog&quot;</span><span class="token operator">:</span> <span class="token string">&quot;weui-miniprogram/dialog/dialog&quot;</span>
  <span class="token punctuation">}</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;usingComponents&quot;</span><span class="token operator">:</span> __mpx_mode__ <span class="token operator">===</span> <span class="token string">'wx'</span>
      <span class="token operator">?</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> wxComponents<span class="token punctuation">)</span>
      <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p><strong>参考</strong>：<a href="https://developers.weixin.qq.com/miniprogram/dev/extended/weui/quickstart.html" target="_blank">weui组件库</a></p></li></ul> <h3 id="mininpmpackage"><a href="#mininpmpackage" class="header-anchor">#</a> miniNpmPackage</h3> <ul><li><p><strong>类型</strong>：<code>Array&lt;string&gt;</code></p></li> <li><p><strong>默认值</strong>: <code>[]</code></p></li> <li><p><strong>详细</strong>: 微信小程序官方提供了<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/npm.html" target="_blank" rel="noopener noreferrer">发布小程序 npm 包的约束<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。
部分小程序npm包，如<a href="https://vant-contrib.gitee.io/vant-weapp/#/quickstart" target="_blank" rel="noopener noreferrer">vant组件库<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>官方文档使用说明，引用资源并不会包含miniprogram所指定的目录
如 &quot;@vant/weapp/button/index&quot;，导致 <code>Mpx</code> 解析路径失败。
<code>Mpx</code>为解决这个问题，提供miniNpmPackage字段供用户配置需要解析的小程序npm包。miniNpmPackage对应的数组值为npm包对应的package.json中的name字段。
<code>Mpx</code>解析规则如下:</p> <ol><li>如package.json中有miniprogram字段，则会默认拼接miniprogram对应的值到资源路径中</li> <li>如package.json中无miniprogram字段，但配置了miniNpmPackage，则默认会拼接miniprogram_dist目录</li></ol></li> <li><p><strong>示例</strong>:</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">miniNpmPackage</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@vant/weapp'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="forceusepagector"><a href="#forceusepagector" class="header-anchor">#</a> forceUsePageCtor</h3> <ul><li><p><strong>类型</strong>: <code>Boolean</code></p></li> <li><p><strong>默认值</strong>: <code>false</code></p></li> <li><p><strong>详细</strong>: 为了获取更丰富的生命周期来进行更加完善的增强处理，在非支付宝小程序环境下，<code>Mpx</code> 默认会使用 <code>Conponent</code> 构造器来创建页面。将该值设置为 <code>true</code> 时，会强制使用 <code>Page</code> 构造器创建页面。</p></li> <li><p><strong>示例</strong>:</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">forceUsePageCtor</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="transrpxrules"><a href="#transrpxrules" class="header-anchor">#</a> transRpxRules</h3> <ul><li><p><strong>类型</strong>：<code>Array&lt;Object&gt; | Object</code></p> <ul><li><code>option.mode</code> 可选值有 none/only/all，分别是不启用/只对注释内容启用/只对非注释内容启用</li> <li><code>option.designWidth</code> 设计稿宽度，默认值就是750，可根据需要修改</li> <li><code>option.include</code> 同webpack的include规则</li> <li><code>option.exclude</code> 同webpack的exclude规则</li> <li><code>option.comment</code> rpx注释，建议使用 'use px'/'use rpx'，当 mode 为 all 时默认值为 use px，mode 为 only 时默认值为 'use rpx'</li></ul></li> <li><p><strong>详细</strong>：为了处理某些IDE中不支持<code>rpx</code>单位的问题，Mpx 提供了一个将 px 转换为 rpx 的功能。支持通过注释控制行级、块级的是否转换，支持局部使用，支持不同依赖分别使用不用的转换规则等灵活的能力。<code>transRpxRules</code>可以是一个对象，也可以是多个这种对象组成的数组。</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">transRpxRules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'only'</span><span class="token punctuation">,</span> <span class="token comment">// 只对注释为'use rpx'的块儿启用转换rpx</span>
      <span class="token literal-property property">comment</span><span class="token operator">:</span> <span class="token string">'use rpx'</span><span class="token punctuation">,</span> <span class="token comment">// mode为'only'时，默认值为'use rpx'</span>
      <span class="token literal-property property">include</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">exclude</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'lib'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">designWidth</span><span class="token operator">:</span> <span class="token number">750</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span> <span class="token comment">// 所有样式都启用转换rpx，除了注释为'use px'的样式不转换</span>
      <span class="token literal-property property">comment</span><span class="token operator">:</span> <span class="token string">'use px'</span><span class="token punctuation">,</span> <span class="token comment">// mode为'all'时，默认值为'use px'</span>
      <span class="token literal-property property">include</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'node_modules/@didi/mpx-sec-guard'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="应用场景及相应配置"><a href="#应用场景及相应配置" class="header-anchor">#</a> 应用场景及相应配置</h4> <p>接下来我们来看下一些应用场景及如何配置。如果是用脚手架生成的项目，在<code>mpx.plugin.conf.js</code>里找到<code>transRpxRules</code>，应该已经有预设的<code>transRpxRules</code>选项，按例修改即可。</p> <p>三种场景分别是 <a href="#%E5%9C%BA%E6%99%AF%E4%B8%80">普通使用</a> ， <a href="#%E5%9C%BA%E6%99%AF%E4%BA%8C">只对某些特殊样式转换</a> ， <a href="#%E5%9C%BA%E6%99%AF%E4%B8%89">不同路径分别配置规则</a></p> <h4 id="场景一"><a href="#场景一" class="header-anchor">#</a> 场景一</h4> <p>设计师给的稿是2倍图，分辨率750px。或者更高倍图。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">transRpxRules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">designWidth</span><span class="token operator">:</span> <span class="token number">750</span> <span class="token comment">// 如果是其他倍，修改此值为设计稿的宽度即可</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="场景二"><a href="#场景二" class="header-anchor">#</a> 场景二</h4> <p>大部分样式都用px下，某些元素期望用rpx。或者反过来。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">transRpxRules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'only'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">comment</span><span class="token operator">:</span> <span class="token string">'use rpx'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">designWidth</span><span class="token operator">:</span> <span class="token number">750</span> <span class="token comment">// 设计稿宽度</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>mpx的rpx注释能帮助你仅为部分类或者部分样式启用rpx转换，细节请看下方附录。</p> <h4 id="场景三"><a href="#场景三" class="header-anchor">#</a> 场景三</h4> <p>使用了第三方组件，它的设计宽度和主项目不一致，期望能设置不同的转换规则</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">transRpxRules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'only'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">designWidth</span><span class="token operator">:</span> <span class="token number">750</span><span class="token punctuation">,</span>
      <span class="token literal-property property">comment</span><span class="token operator">:</span> <span class="token string">'use rpx'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">designWidth</span><span class="token operator">:</span> <span class="token number">1280</span><span class="token punctuation">,</span> <span class="token comment">// 对iview单独使用一个不同的designWidth</span>
      <span class="token literal-property property">include</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'node_modules/iview-weapp'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><blockquote><p>注意事项：转换规则是不可以对一个文件做多次转换的，会出错，所以一旦被一个规则命中后就不会再次命中另一个规则，include 和 exclude 的编写需要注意先后顺序，就比如上面这个配置，如果第一个规则 include 的是 '/' 即整个项目，iview-weapp 里的样式就无法命中第二条规则了。</p></blockquote> <h4 id="transrpxrules附录"><a href="#transrpxrules附录" class="header-anchor">#</a> transRpxRules附录</h4> <ul><li><strong>designWidth</strong></li></ul> <p>设计稿宽度，单位为<code>px</code>。默认值为<code>750px</code>。</p> <p><code>mpx</code>会基于小程序标准的屏幕宽度<code>baseWidth 750rpx</code>，与<code>option.designWidth</code>计算出一个转换比例<code>transRatio</code>。</p> <p>转换比例的计算方式为<code>transRatio = (baseWidth / designWidth)</code>，精度为小数点后2位四舍五入。</p> <p>所有生效的<code>rpx注释样式</code>中的px会乘上<code>transRatio</code>得出最终的 rpx 值。</p> <p>例如：</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/* 转换前：designWidth = 1280 */</span>
<span class="token selector">.btn</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 转换后: transRatio = 0.59 */</span>
<span class="token selector">.btn</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 118rpx<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 59rpx<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><strong>comment: rpx 注释样式</strong></li></ul> <p>根据<code>rpx注释</code>的位置，<code>mpx</code>会将<code>一段css规则</code>或者<code>一条css声明</code>视为<code>rpx注释样式</code>。</p> <p>开发者可以声明一段 rpx 注释样式，提示编译器是否转换这段 css 中的 px。</p> <p>例如：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token comment">/* use rpx */</span>
  <span class="token selector">.not-translate-a</span> <span class="token punctuation">{</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.not-translate-b</span> <span class="token punctuation">{</span>
    <span class="token comment">/* use rpx */</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.translate-a</span> <span class="token punctuation">{</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.translate-b</span> <span class="token punctuation">{</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>第一个注释位于一个<code>选择器</code>前，是一个<code>css规则注释</code>，整个规则都会被视为<code>rpx注释样式</code></p></blockquote> <blockquote><p>第二个注释位于一个<code>css声明</code>前，是一个<code>css声明注释</code>，只有<code>font-size: 100px</code>会被视为<code>rpx注释样式</code></p></blockquote> <blockquote><p><code>transRpx = only</code>模式下，只有两部分<code>rpx注释样式</code>会转rpx。</p></blockquote> <h3 id="postcssinlineconfig"><a href="#postcssinlineconfig" class="header-anchor">#</a> postcssInlineConfig</h3> <ul><li><p><strong>类型</strong>： <code>{options? : PostcssOptions, plugins? : PostcssPlugin[], ignoreConfigFile : Boolean}</code></p></li> <li><p><strong>详细</strong>：使用类似于 postcss.config.js 的语法书写 postcss 的配置文件。用于定义 Mpx 对于组件/页面样式进行 postcss 处理时的配置， ignoreConfigFile 传递为 true 时会忽略项目中的 postcss 配置文件 。</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">postcssInlineConfig</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// require('postcss-import'),</span>
      <span class="token comment">// require('postcss-preset-env'),</span>
      <span class="token comment">// require('cssnano'),</span>
      <span class="token comment">// require('autoprefixer')</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="decodehtmltext"><a href="#decodehtmltext" class="header-anchor">#</a> decodeHTMLText</h3> <ul><li><p><strong>类型</strong>：<code>boolean</code></p></li> <li><p><strong>默认</strong>：<code>false</code></p></li> <li><p><strong>详细</strong>：</p></li></ul> <p>设置为 true 时在模板编译时对模板中的 text 内容进行 decode</p> <h3 id="nativeconfig"><a href="#nativeconfig" class="header-anchor">#</a> nativeConfig</h3> <ul><li><p><strong>类型</strong>：<code>{cssLangs: string[]}</code></p></li> <li><p><strong>详细</strong>：为原生多文件写法添加css预处理语言支持，用于优先搜索预编译器后缀的文件，按 cssLangs 中的声明顺序查找。默认按照 css , less , stylus ,  scss , sass 的顺序</p></li> <li><p><strong>例子</strong></p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">nativeConfig</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">cssLangs</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'css'</span><span class="token punctuation">,</span> <span class="token string">'less'</span><span class="token punctuation">,</span> <span class="token string">'stylus'</span><span class="token punctuation">,</span> <span class="token string">'scss'</span><span class="token punctuation">,</span> <span class="token string">'sass'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="webconfig"><a href="#webconfig" class="header-anchor">#</a> webConfig</h3> <ul><li><p><strong>类型</strong>：<code>{transRpxFn: (match:string, $1:number) =&gt; string}</code></p></li> <li><p><strong>详细</strong>：transRpxFn 配置用于自定义输出 web 时对于 rpx 样式单位的转换逻辑，常见的方式有转换为 vw 或转换为 rem</p></li> <li><p><strong>例子</strong></p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">webConfig</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">transRpxFn</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">match<span class="token punctuation">,</span> $1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>$1 <span class="token operator">===</span> <span class="token string">'0'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> $1
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$1 <span class="token operator">*</span> <span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">/</span> <span class="token number">750</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">vw</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="i18n"><a href="#i18n" class="header-anchor">#</a> i18n</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">i18n</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">locale</span><span class="token operator">:</span> <span class="token string">'en-US'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">messages</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'en-US'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">hello</span><span class="token operator">:</span> <span class="token string">'{msg} world'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">'zh-CN'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">hello</span><span class="token operator">:</span> <span class="token string">'{msg} 世界'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// messagesPath: path.resolve(__dirname, '../src/i18n.js')</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><strong>详细</strong>：Mpx 支持国际化，底层实现依赖类<code>wxs</code>能力，通过指定语言标识和语言包，可实现多语言之间的动态切换。可配置项包括locale、messages、messagesPath。</li></ul> <h4 id="i18n-locale-string"><a href="#i18n-locale-string" class="header-anchor">#</a> i18n.locale   <code>String</code></h4> <p>通过配置 locale 属性，可指定语言标识，默认值为 'zh-CN'</p> <h4 id="i18n-messages-object"><a href="#i18n-messages-object" class="header-anchor">#</a> i18n.messages   <code>Object</code></h4> <p>通过配置 messages 属性，可以指定项目语言包，Mpx 会依据语言包对象定义进行转换，示例如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">messages</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'en-US'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'title'</span><span class="token operator">:</span> <span class="token string">'DiDi Chuxing'</span><span class="token punctuation">,</span>
      <span class="token string-property property">'subTitle'</span><span class="token operator">:</span> <span class="token string">'Make travel better'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">'zh-CN'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'title'</span><span class="token operator">:</span> <span class="token string">'滴滴出行'</span><span class="token punctuation">,</span>
      <span class="token string-property property">'subTitle'</span><span class="token operator">:</span> <span class="token string">'让出行更美好'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="i18n-messagespath-string"><a href="#i18n-messagespath-string" class="header-anchor">#</a> i18n.messagesPath   <code>String</code></h4> <p>为便于开发，Mpx 还支持配置语言包资源路径 messagesPath 来代替 messages 属性，Mpx 会从该路径下的 js 文件导出语言包对象。如果同时配置 messages 和 messagesPath 属性，Mpx 会优先设定 messages 为 i18n 语言包资源。</p> <p>详细介绍及使用见<a href="/guide/tool/i18n.html">工具-国际化i18n</a>一节。</p> <h3 id="auditresource"><a href="#auditresource" class="header-anchor">#</a> auditResource</h3> <ul><li><p><strong>类型</strong>：<code>true | false | 'component'</code></p></li> <li><p><strong>详细</strong>：检查资源输出情况，如果置为true，则会提示有哪些资源被同时输出到了多个分包，可以检查是否应该放进主包以消减体积，设置为 <code>'component'</code> 的话，则只检查组件资源是否被输出到多个分包。</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">auditResource</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="subpackagemodulesrules"><a href="#subpackagemodulesrules" class="header-anchor">#</a> subpackageModulesRules</h3> <ul><li><p><strong>类型</strong>：<code>Object</code></p></li> <li><p><strong>详细</strong>：是否将多分包共用的模块分别输出到各自分包中，匹配规则为include匹配到且未被exclude匹配到的资源</p></li> <li><p><strong>背景</strong>：依据微信小程序的分包策略，多个分包使用到的 js 模块会打入主包当中，但在大型分包较多的项目中，该策略极易将大量的模块打入主包，从而使主包体积大小超出2M限制，该配置项提供给开发者自主抉择，可将部分模块冗余输出至多个分包，从而控制主包体积不超限</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">subpackageModulesRules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@someNpm/name/src/api/*.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@someNpm/name/src/api/module.js'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>tips: 该功能是将模块分别放入多个分包，模块状态不可复用，使用前要依据模块功能做好评估，例如全局store就不适用该功能</p></blockquote> <h3 id="generatebuildmap"><a href="#generatebuildmap" class="header-anchor">#</a> generateBuildMap</h3> <ul><li><p><strong>类型</strong>：<code>boolean</code></p></li> <li><p><strong>详细</strong>：是否生成构建结果与源码之间的映射文件。用于单元测试等场景。</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">generateBuildMap</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><strong>参考</strong>：<a href="/guide/tool/unit-test.html">单元测试</a></li></ul> <h3 id="autovirtualhostrules"><a href="#autovirtualhostrules" class="header-anchor">#</a> autoVirtualHostRules</h3> <ul><li><strong>类型</strong>：<a href="#rules"><code>Rules</code></a></li> <li><strong>详细</strong>：批量配置是否虚拟化组件节点，对应微信中<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html" target="_blank" rel="noopener noreferrer"><code>VirtualHost</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 。默认不开启，开启后也将抹平支付宝小程序中的表现差异。提供 include 和 exclude 以精确控制对哪些文件开启VirtualHost，哪些不开启。和webpack的rules规则相同。</li> <li><strong>背景</strong>：默认情况下，自定义组件本身的那个节点是一个“普通”的节点，使用时可以在这个节点上设置 <code>class</code> 、<code>style</code> 、动画、 flex 布局等，就如同普通的 view 组件节点一样。但有些时候，自定义组件并不希望这个节点本身可以设置样式、响应 flex 布局等，而是希望自定义组件内部的第一层节点能够响应 flex 布局或者样式由自定义组件本身完全决定。这种情况下，可以将这个自定义组件设置为“虚拟的”。</li> <li><strong>示例</strong>：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">autoVirtualHostRules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'../src'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'../components/other'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="partialcompile"><a href="#partialcompile" class="header-anchor">#</a> partialCompile</h3> <ul><li><p><strong>详细</strong>：在大型的小程序开发当中，全量打包页面耗时非常长，往往在<code>开发过程</code>中仅仅只需用到几个 pages 而已，该配置项支持打包指定的小程序页面。</p></li> <li><p><strong>类型</strong>：<code>{ include: string | RegExp | Function | Array&lt;string | RegExp | Function&gt; }</code></p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// include 可以是正则、字符串、函数、数组</span>
<span class="token keyword">new</span> <span class="token class-name">MpxWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">partialCompile</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token string">'/project/pages'</span><span class="token punctuation">,</span> <span class="token comment">// 文件路径包含 '/project/pages' 的页面都会被打包</span>
    <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">pages\/internal</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 文件路径能与正则匹配上的页面都会被打包</span>
    <span class="token function">include</span> <span class="token punctuation">(</span><span class="token parameter">pageResourcePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// pageResourcePath 是小程序页面所在系统的文件路径</span>
      <span class="token keyword">return</span> pageResourcePath<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'pages'</span><span class="token punctuation">)</span> <span class="token comment">// 文件路径包含 'pages' 的页面都会被打包</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'/project/pages'</span><span class="token punctuation">,</span>
      <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">pages\/internal</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token parameter">pageResourcePath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> pageResourcePath<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'pages'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span> <span class="token comment">// 满足任意条件的页面都会被打包</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>该特性只能用于<strong>开发环境</strong>，默认情况下会阻止所有页面(<strong>入口 app.mpx 除外</strong>)的打包。</p></div> <h2 id="mpxwebpackplugin-static-methods"><a href="#mpxwebpackplugin-static-methods" class="header-anchor">#</a> MpxWebpackPlugin static methods</h2> <p><code>MpxWebpackPlugin</code> 通过静态方法暴露了以下五个内置 loader，详情如下：</p> <h3 id="mpxwebpackplugin-loader"><a href="#mpxwebpackplugin-loader" class="header-anchor">#</a> MpxWebpackPlugin.loader</h3> <p><code>MpxWebpackPlugin</code> 所提供的最主要 loader，用于处理 <code>.mpx</code> 文件，根据不同的<a href="/api/compile.html#mode">模式(mode)</a>将 <code>.mpx</code> 文件输出为不同的结果。</p> <blockquote><p>* 在微信环境下 <code>todo.mpx</code> 被loader处理后的文件为：<code>todo.wxml</code>、<code>todo.wxss</code>、<code>todo.js</code>、<code>todo.json</code></p></blockquote> <p><strong>webpack.conf.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.mpx$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> MpxWebpackPlugin<span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="options"><a href="#options" class="header-anchor">#</a> Options</h4> <h5 id="options-transrpx-array-object-object"><a href="#options-transrpx-array-object-object" class="header-anchor">#</a> Options.transRpx <code>{Array&lt;Object&gt; | Object}</code></h5> <p>用于统一转换 px 或者 rpx 单位，默认值为<code>{}</code>，详见 <a href="/api/compile.html#transrpxrules">transRpxRules</a></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p><code>transRpx</code> 即将在<code>v2.6.0</code>版本中<strong>移除</strong>，请在统一配置文件 <code>build/mpx.plugin.conf.js</code> 中使用 <code>transRpxRules</code> 属性进行配置。</p></div> <h5 id="options-loaders-object"><a href="#options-loaders-object" class="header-anchor">#</a> Options.loaders <code>{Object}</code></h5> <p>可用于对某些资源文件的默认 loader 做覆盖或新增处理，以下例子演示了对 <a href="https://webpack.docschina.org/loaders/less-loader/" target="_blank" rel="noopener noreferrer">less-loader<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 做额外配置。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.mpx$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> MpxWebpackPlugin<span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// loaders选项</span>
            <span class="token literal-property property">less</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// 针对less做loader配置</span>
              <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span>
                <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'less-loader'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 为less-loader添加额外配置</span>
                  <span class="token literal-property property">lessOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">strictMath</span><span class="token operator">:</span> <span class="token boolean">true</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="options-templateoption-object"><a href="#options-templateoption-object" class="header-anchor">#</a> Options.templateOption <code>{Object}</code></h5> <p>针对使用其他模板引擎(如 <a href="https://www.pugjs.cn/api/getting-started.html" target="_blank" rel="noopener noreferrer">pug<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)来编写 template 的情景下，可通过 <code>options.templateOption</code> 来传入引擎渲染时的额外参数。等同于：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> pug <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'pug'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> template <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">view(class='gray') 这是一段pug模板</span><span class="token template-punctuation string">`</span></span>

pug<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> options<span class="token punctuation">.</span>templateOption<span class="token punctuation">)</span>
</code></pre></div><h5 id="options-excludedpreloaders-regexp"><a href="#options-excludedpreloaders-regexp" class="header-anchor">#</a> Options.excludedPreLoaders <code>{RegExp}</code></h5> <p>在构建过程中忽略特定 <code>pre-loader</code> 对文件的处理，仅支持正则表达式，默认值为 <code>/eslint-loader/</code>。</p> <h3 id="mpxwebpackplugin-pluginloader"><a href="#mpxwebpackplugin-pluginloader" class="header-anchor">#</a> MpxWebpackPlugin.pluginLoader</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>该 loader 仅在开发<strong>小程序插件</strong>时使用，可在使用 Mpx 脚手架进行项目初始化时选择进行组件开发来生成对应的配置文件。</p></div> <p><code>MpxWebpackPlugin.pluginLoader</code> 用于根据开发者编写的<code>plugin.json</code>文件内容，将特定的小程序组件、页面以及 js 文件进行构建，最终以小程序插件的形式输出。</p> <p><strong>webpack.plugin.conf.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">resource</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/plugin/plugin.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 小程序插件的plugin.json的绝对路径</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> MpxWebpackPlugin<span class="token punctuation">.</span><span class="token function">pluginLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>更多细节请查阅 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/plugin/development.html" target="_blank" rel="noopener noreferrer">小程序插件开发<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="mpxwebpackplugin-wxspreloader"><a href="#mpxwebpackplugin-wxspreloader" class="header-anchor">#</a> MpxWebpackPlugin.wxsPreLoader</h3> <p>加载并解析 <code>wxs</code> 脚本文件，并针对不同平台，做了差异化处理；同时可支持处理内联<code>wxs</code>。</p> <ul><li><strong>用法</strong>：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(wxs|qs|sjs|filter\.js)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> MpxWebpackPlugin<span class="token punctuation">.</span><span class="token function">wxsPreLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token string">'pre'</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="mpxwebpackplugin-fileloader"><a href="#mpxwebpackplugin-fileloader" class="header-anchor">#</a> MpxWebpackPlugin.fileLoader</h3> <p>提供图像资源的处理，生成对应图像文件，输出到输出目录并返回 public URL。如果是分包资源，则会输出到相应的分包资源文件目录中。</p> <ul><li><strong>用法</strong>：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> MpxWebpackPlugin<span class="token punctuation">.</span><span class="token function">fileLoader</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'img/[name][hash].[ext]'</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><ul><li><p><strong>选项</strong>：</p> <ul><li><code>name</code> : 自定义输出文件名模板</li></ul></li></ul> <h3 id="mpxwebpackplugin-urlloader"><a href="#mpxwebpackplugin-urlloader" class="header-anchor">#</a> MpxWebpackPlugin.urlLoader</h3> <p>微信小程序对于图像资源存在一些限制，<code>MpxWebpackPlugin.urlLoader</code> 针对这些差异做了相关处理，开发者可以使用web应用开发的方式进行图像资源的引入，<code>MpxWebpackPlugin.urlLoader</code> 可根据图像资源的不同引入方式，支持 CDN 或者 Base64 的方式进行处理。更多细节请查阅<a href="/guide/advance/image-process.html">图像资源处理</a>。</p> <ul><li><strong>用法</strong>:</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> MpxWebpackPlugin<span class="token punctuation">.</span><span class="token function">urlLoader</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'img/[name][hash].[ext]'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">2048</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><ul><li><p><strong>选项</strong>:</p> <ul><li><code>name</code> :  自定义输出文件名模板</li> <li><code>mimetype</code> : 指定文件的 MIME 类型</li> <li><code>limit</code> : 对内联文件作为数据 URL 的字节数限制</li> <li><code>publicPath</code> : 自定义 public 目录</li> <li><code>fallback</code> : 文件字节数大于限制时，为文件指定加载程序</li></ul></li></ul> <h2 id="request-query"><a href="#request-query" class="header-anchor">#</a> Request query</h2> <p>Mpx中允许用户在request中传递特定query执行特定逻辑，目前已支持的query如下：</p> <h3 id="resolve"><a href="#resolve" class="header-anchor">#</a> ?resolve</h3> <ul><li><p><strong>详细</strong>:</p> <p>获取资源最终被输出的正确路径。</p></li> <li><p><strong>背景</strong>:</p> <p>Mpx 在处理页面路径时会把对应的分包名作为 root 加在路径前。处理组件路径时会添加 hash，防止路径名冲突。直接写资源相对路径可能与最终输出的资源路径不符。</p> <p>编写代码时使用 import 引入页面地址后加上 <code>?resolve</code>，这个地址在编译时会被处理成正确的绝对路径，即资源的最终输出位置。</p></li> <li><p><strong>示例</strong>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> subPackageIndexPage <span class="token keyword">from</span> <span class="token string">'../subpackage/pages/index.mpx?resolve'</span>

mpx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> subPackageIndexPage
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h3 id="root"><a href="#root" class="header-anchor">#</a> ?root</h3> <ol><li>声明分包别名</li></ol> <ul><li><p><strong>详细</strong>：指定分包别名，Mpx 项目在编译构建后会输出该别名的分包，外部小程序或 H5 页面跳转时，可直接配置该分包别名下的资源路径。</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 可在项目app.mpx中进行配置</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">packages</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'@packagePath/src/app.mpx?root=test'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用</span>
wx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">url</span> <span class="token operator">:</span> <span class="token string">'/test/homepage/index'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>声明组件所属异步分包</li></ol> <ul><li><p><strong>详细</strong>：微信小程序新增 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/async.html" target="_blank" rel="noopener noreferrer">分包异步化特性<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ，使跨分包的组件可以等待对应分包下载后异步使用, 在mpx中使用需通过?root声明组件所属异步分包即可使用，示例如下：</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--/packageA/pages/index.mpx--&gt;</span>
// 这里在分包packageA中即可异步使用分包packageB中的hello组件
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>application/json<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;usingComponents&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;hello&quot;</span><span class="token operator">:</span> <span class="token string">&quot;../../packageB/components/hello?root=packageB&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;simple-hello&quot;</span><span class="token operator">:</span> <span class="token string">&quot;../components/hello&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;componentPlaceholder&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;hello&quot;</span><span class="token operator">:</span> <span class="token string">&quot;simple-hello&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="fallback"><a href="#fallback" class="header-anchor">#</a> ?fallback</h3> <ul><li><p><strong>类型</strong>：<code>String</code></p></li> <li><p><strong>详细</strong>：对于使用<code>MpxWebpackPlugin.urlLoader</code>的文件，如果在引用资源的末尾加上<code>?fallback=true</code>，则使用配置的自定义loader。图片的引入和处理详见<a href="/guide/advance/image-process.html">图像资源处理</a>。</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.config.js配置</span>
<span class="token keyword">const</span> webpackConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">loader</span><span class="token operator">:</span> MpxWebpackPlugin<span class="token punctuation">.</span><span class="token function">urlLoader</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'img/[name][hash].[ext]'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token string">'http://a.com/'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">fallback</span><span class="token operator">:</span> <span class="token string">'file-loader'</span> <span class="token comment">// 自定义fallback为true时使用的loader</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/* png资源引入 */</span>
<span class="token selector">&lt;style&gt;
  .logo2</span> <span class="token punctuation">{</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">'./images/logo.png?fallback=true'</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span> <span class="token comment">/* 设置fallback=true，则使用如上方所配置的file-loader */</span>
  <span class="token punctuation">}</span>
&lt;/style&gt;
</code></pre></div><h3 id="uselocal"><a href="#uselocal" class="header-anchor">#</a> ?useLocal</h3> <ul><li><p><strong>类型</strong>：<code>Boolean</code></p></li> <li><p><strong>详细</strong>：静态资源存放有两种方式：本地、远程（配置 publicPath ）。useLocal 是用于在配置了 publicPath 时声明部分资源输出到本地。比如配置了通用的 CDN 策略，但如网络兜底资源需要强制走本地存储，可在引用资源的末尾加上<code>?useLocal=true</code></p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/* 单个图片资源设置为存储到本地 */</span>
<span class="token selector">&lt;style&gt;
  .logo2</span> <span class="token punctuation">{</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">'./images/logo.png?useLocal=true'</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
&lt;/style&gt;
</code></pre></div><h3 id="isstyle"><a href="#isstyle" class="header-anchor">#</a> ?isStyle</h3> <ul><li><p><strong>类型</strong>：<code>Boolean</code></p></li> <li><p><strong>详细</strong>：isStyle 是在非 style 模块中编写样式时，声明这部分引用的静态资源按照 style 环境来处理。如在 javascript 中 require 了一个图像资源，然后模版 template style 属性中进行引用， 则 require 资源时可选择配置<code>?isStyle=true</code></p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- isStyle 案例一：引用 javascript 中的数据 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token punctuation">{</span><span class="token punctuation">{</span>testStyle<span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>测试<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- isStyle 案例二：设置资源按照style处理规则处理。style处理规则为: 默认走base64，除非同时配置了 publicPath 和 fallback --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../images/car.jpg?isStyle=true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 普通非style模式，默认走 fallback 或者 file-loader 解析，输出到 publicPath 或者 本地img目录下 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../images/car.jpg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* 将 script 中的图像资源标识为 style 资源 */</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> createComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>
  <span class="token keyword">const</span> backCar <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../images/car.jpg?isStyle=true'</span><span class="token punctuation">)</span>

  <span class="token function">createComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">testStyle</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">background-image : url(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>backCar<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">); width:100px; height: 100px</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h3 id="ispage"><a href="#ispage" class="header-anchor">#</a> ?isPage</h3> <ul><li><p><strong>类型</strong>：<code>Boolean</code></p></li> <li><p><strong>详细</strong>：在 webpack config entry 入口文件配置中，你可以在路径后追加 ?isPage 来声明独立页面构建，构建产物为该页面的独立原生代码，
你可以提供该页面给其他小程序使用。</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* webpack config option entry */</span>
<span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">'../src/pages/index.mpx?isPage'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此外，独立页面构建也可以通过MpxWebpackPlugin.getPageEntry生成</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> MpxWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@mpxjs/webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">index</span><span class="token operator">:</span> MpxWebpackPlugin<span class="token punctuation">.</span><span class="token function">getPageEntry</span><span class="token punctuation">(</span><span class="token string">'./index.mpx'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="iscomponent"><a href="#iscomponent" class="header-anchor">#</a> ?isComponent</h3> <ul><li><p><strong>类型</strong>：<code>Boolean</code></p></li> <li><p><strong>详细</strong>：在 webpack config entry 入口文件配置中，你可以在路径后追加 ?isComponent 来声明独立组件构建，构建产物为该组件的独立原生代码，
你可以提供该组件给其他小程序使用。</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* webpack config option entry */</span>
<span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">'../src/components/list.mpx?isComponent'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此外，独立组件构建也可以通过MpxWebpackPlugin.getComponentEntry生成</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> MpxWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@mpxjs/webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">index</span><span class="token operator">:</span> MpxWebpackPlugin<span class="token punctuation">.</span><span class="token function">getComponentEntry</span><span class="token punctuation">(</span><span class="token string">'./components/list.mpx'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="async"><a href="#async" class="header-anchor">#</a> ?async</h3> <ul><li><p><strong>类型</strong>：<code>Boolean || string</code></p></li> <li><p><strong>详细</strong>：输出 H5 时 Vue Router 的路由懒加载功能，Mpx框架默认会对分包开启路由懒加载功能并将分包所有页面都打入同一个Chunk
，如果你希望对于部分主包页面或者分包页面配置路由懒加载并想自定义Chunk Name，则可以使用该功能。</p></li> <li><p><strong>示例</strong>：</p></li></ul> <div class="language-html extra-class"><pre class="language-html"><code>// app.mpx 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>application/json<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;./pages/index?async&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 主包页面配置路由懒加载，Chunk Name 为随机数字</span>
      <span class="token string">&quot;./pages/index2?async=app_pages2&quot;</span>，<span class="token comment">// 主包页面配置路由懒加载，Chunk Name 自定义为 app_pages2</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;./packages/sub1/app.mpx?root=sub1&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

// packages/sub1/app.mpx

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>application/json<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;./pages/index?async=sub1_pages_index&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 分包中页面设置路由懒加载并设置自定义Chunk Name</span>
      <span class="token string">&quot;./pages/index2?async=sub2_pages_index2&quot;</span> <span class="token comment">// 分包中页面设置路由懒加载并设置自定义Chunk Name</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/api/directives.html" class="prev">
        模板指令
      </a></span> <span class="next"><a href="/api/builtIn.html">
        内建组件
      </a>
      →
    </span></p></div> </main></div></div></div></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.b3e4347f.js" defer></script><script src="/assets/js/6.831707e4.js" defer></script><script src="/assets/js/1.8362f1c2.js" defer></script><script src="/assets/js/18.b378d290.js" defer></script><script src="/assets/js/7.d18ec5bf.js" defer></script>
  </body>
</html>
